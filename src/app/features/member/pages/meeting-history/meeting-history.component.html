<div class="meeting-history-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Lịch Sử Cuộc Họp</h1>
      <p class="page-subtitle">Xem lại các cuộc họp đã tham gia và tìm kiếm thông tin</p>
    </div>
    <div class="header-actions">
      <button type="button" class="btn btn-outline" (click)="refreshHistory()">
        <span class="btn-icon">🔄</span>
        Làm Mới
      </button>
      <button type="button" class="btn btn-primary" (click)="exportHistory()">
        <span class="btn-icon">📤</span>
        Xuất Báo Cáo
      </button>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="search-filters-section">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="Tìm kiếm theo tên cuộc họp, dự án, từ khóa..."
        [(ngModel)]="searchTerm"
        (input)="filterMeetings()"
        class="search-input"
      >
      <span class="search-icon">🔍</span>
    </div>
    
    <div class="filter-options">
      <select [(ngModel)]="projectFilter" (change)="filterMeetings()" class="filter-select" title="Dự án" aria-label="Lọc theo dự án">
        <option value="">Tất cả dự án</option>
        <option *ngFor="let project of projects()" [value]="project">{{ project }}</option>
      </select>
      
      <select [(ngModel)]="dateFilter" (change)="filterMeetings()" class="filter-select" title="Thời gian" aria-label="Lọc theo thời gian">
        <option value="">Tất cả thời gian</option>
        <option value="today">Hôm nay</option>
        <option value="week">Tuần này</option>
        <option value="month">Tháng này</option>
        <option value="quarter">Quý này</option>
        <option value="year">Năm nay</option>
      </select>
    </div>
  </div>

  <!-- Meeting History Grid -->
  <div class="meetings-grid">
    <div *ngFor="let meeting of filteredMeetings()" class="meeting-card">
      <div class="meeting-header">
        <div class="meeting-date">
          <div class="date">{{ meeting.date }}</div>
          <div class="time">{{ meeting.time }}</div>
        </div>
        <div class="meeting-status" [class]="meeting.status">
          {{ getStatusText(meeting.status) }}
        </div>
      </div>
      
      <div class="meeting-content">
        <h3 class="meeting-title">{{ meeting.title }}</h3>
        <p class="meeting-project">{{ meeting.project }}</p>
        <p class="meeting-description">{{ meeting.description }}</p>
        
        <div class="meeting-meta">
          <span class="organizer">👤 {{ meeting.organizer }}</span>
          <span class="duration">⏱️ {{ meeting.duration }}</span>
          <span class="participants">👥 {{ meeting.participants.length }} người</span>
        </div>
      </div>
      
      <div class="meeting-actions">
        <button type="button" class="btn btn-sm btn-outline" (click)="viewTranscript(meeting)">
          <span class="btn-icon">📝</span>
          Transcript
        </button>
        <button type="button" class="btn btn-sm btn-outline" (click)="viewSummary(meeting)">
          <span class="btn-icon">📋</span>
          Summary
        </button>
        <button type="button" class="btn btn-sm btn-outline" (click)="viewTodoList(meeting)">
          <span class="btn-icon">✅</span>
          To-do List
        </button>
        <button type="button" class="btn btn-sm btn-primary" (click)="viewMeetingDetails(meeting)">
          <span class="btn-icon">👁️</span>
          Chi Tiết
        </button>
      </div>
      
      <div class="meeting-tags" *ngIf="meeting.tags.length > 0">
        <span 
          *ngFor="let tag of meeting.tags" 
          class="meeting-tag"
        >
          {{ tag }}
        </span>
      </div>
    </div>
    
    <div *ngIf="filteredMeetings().length === 0" class="empty-state">
      <div class="empty-icon">📅</div>
      <h3>Không có cuộc họp nào</h3>
      <p>{{ searchTerm || projectFilter || dateFilter ? 'Thử thay đổi bộ lọc để xem kết quả khác' : 'Bạn chưa tham gia cuộc họp nào' }}</p>
    </div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="quick-actions-panel">
    <div class="panel-header">
      <h3>Thao Tác Nhanh</h3>
    </div>
    <div class="panel-content">
      <button type="button" class="quick-action-btn" (click)="viewTodayMeetings()">
        <span class="action-icon">📅</span>
        <span class="action-text">Họp Hôm Nay</span>
      </button>
      <button type="button" class="quick-action-btn" (click)="viewRecentMeetings()">
        <span class="action-icon">🕒</span>
        <span class="action-text">Họp Gần Đây</span>
      </button>
      <button type="button" class="quick-action-btn" (click)="searchByKeywords()">
        <span class="action-icon">🔍</span>
        <span class="action-text">Tìm Theo Từ Khóa</span>
      </button>
      <button type="button" class="quick-action-btn" (click)="viewProjectMeetings()">
        <span class="action-icon">📊</span>
        <span class="action-text">Họp Theo Dự Án</span>
      </button>
    </div>
  </div>

  <!-- Modals -->
  <!-- Transcript Modal -->
  <div class="modal-backdrop" *ngIf="isTranscriptOpen" (click)="closeTranscript()"></div>
  <div class="modal modal-lg" *ngIf="isTranscriptOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>Transcript - {{ activeMeeting?.title }}</h3>
      <button type="button" class="icon-btn" (click)="closeTranscript()">✖</button>
    </div>
    <div class="modal-body">
      <div class="search-box" style="margin-bottom:12px;">
        <input type="text" class="search-input" placeholder="Tìm trong transcript..." [(ngModel)]="transcriptQuery">
      </div>
      <div class="modal-body scrollable">
        <div class="transcript-item" *ngFor="let line of filteredTranscript">
          <div class="speaker">{{ line.speaker }}:</div>
          <div class="speech">{{ line.text }}</div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline" (click)="copyTranscript()" [disabled]="filteredTranscript.length === 0" aria-label="Copy transcript" title="Sao chép transcript">
        📋 Copy
      </button>
      <button type="button" class="btn btn-primary" (click)="exportTranscript()" [disabled]="filteredTranscript.length === 0" aria-label="Export transcript" title="Tải transcript">
        ⬇️ Export
      </button>
    </div>
  </div>

  <!-- Summary Modal -->
  <div class="modal-backdrop" *ngIf="isSummaryOpen" (click)="closeSummary()"></div>
  <div class="modal modal-md" *ngIf="isSummaryOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>Tóm tắt - {{ activeMeeting?.title }}</h3>
      <button type="button" class="icon-btn" (click)="closeSummary()">✖</button>
    </div>
    <div class="modal-body">
      <div class="summary-block" *ngFor="let block of summaryBlocks">
        <div class="summary-title">{{ block.title }}</div>
        <div class="summary-content">{{ block.content }}</div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline" (click)="copySummary()" [disabled]="summaryBlocks.length === 0" aria-label="Copy summary" title="Sao chép tóm tắt">
        📋 Copy
      </button>
      <button type="button" class="btn btn-primary" (click)="exportSummary()" [disabled]="summaryBlocks.length === 0" aria-label="Export summary" title="Tải tóm tắt">
        ⬇️ Export
      </button>
    </div>
  </div>

  <!-- Todo Modal -->
  <div class="modal-backdrop" *ngIf="isTodoOpen" (click)="closeTodo()"></div>
  <div class="modal modal-md" *ngIf="isTodoOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>To-do - {{ activeMeeting?.title }}</h3>
      <button type="button" class="icon-btn" (click)="closeTodo()">✖</button>
    </div>
    <div class="modal-body">
      <div class="todo-item" *ngFor="let item of todoItems">
        <input type="checkbox" [checked]="item.done" (change)="toggleTodoDone(item.id)">
        <div class="todo-content">
          <div class="todo-text" [class.done]="item.done">{{ item.text }}</div>
          <div class="todo-meta">
            <span *ngIf="item.assignee">👤 {{ item.assignee }}</span>
            <span *ngIf="item.due">⏰ {{ item.due }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline" (click)="copyTodos()" [disabled]="todoItems.length === 0" aria-label="Copy todos" title="Sao chép To-do">
        📋 Copy
      </button>
      <button type="button" class="btn btn-primary" (click)="exportTodos()" [disabled]="todoItems.length === 0" aria-label="Export todos" title="Tải To-do">
        ⬇️ Export
      </button>
    </div>
  </div>

  <!-- Details Modal -->
  <div class="modal-backdrop" *ngIf="isDetailsOpen" (click)="closeDetails()"></div>
  <div class="modal modal-md" *ngIf="isDetailsOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>Chi tiết cuộc họp - {{ activeMeeting?.title }}</h3>
      <button type="button" class="icon-btn" (click)="closeDetails()">✖</button>
    </div>
    <div class="modal-body">
      <div class="details-grid">
        <div><strong>Ngày:</strong> {{ activeMeeting?.date }}</div>
        <div><strong>Giờ:</strong> {{ activeMeeting?.time }}</div>
        <div><strong>Thời lượng:</strong> {{ activeMeeting?.duration }}</div>
        <div><strong>Trạng thái:</strong> {{ activeMeeting ? getStatusText(activeMeeting.status) : '' }}</div>
        <div><strong>Dự án:</strong> {{ activeMeeting?.project }}</div>
        <div><strong>Người tổ chức:</strong> {{ activeMeeting?.organizer }}</div>
        <div class="participants-list">
          <strong>Tham dự:</strong> {{ (activeMeeting?.participants || []).join(', ') }}
        </div>
        <div><strong>Mô tả:</strong> {{ activeMeeting?.description }}</div>
      </div>  
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline" (click)="closeDetails()">Đóng</button>
    </div>
  </div>
</div>