<div class="tasks-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Qu·∫£n L√Ω Nhi·ªám V·ª•</h1>
      <p class="page-subtitle">Theo d√µi v√† c·∫≠p nh·∫≠t ti·∫øn ƒë·ªô c√¥ng vi·ªác c·ªßa b·∫°n</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="refreshTasks()">
        <span class="btn-icon">üîÑ</span>
        L√†m M·ªõi
      </button>
      <!-- <button class="btn btn-primary" (click)="createTask()">
        <span class="btn-icon">‚ûï</span>
        T·∫°o Nhi·ªám V·ª•
      </button> -->
    </div>
  </div>

  <!-- Task Stats -->
  <div class="task-stats">
    <div class="stat-item">
      <div class="stat-icon">üìã</div>
      <div class="stat-content">
        <div class="stat-number">{{ taskStats().total }}</div>
        <div class="stat-label">T·ªïng Nhi·ªám V·ª•</div>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon">‚è≥</div>
      <div class="stat-content">
        <div class="stat-number">{{ taskStats().inProgress }}</div>
        <div class="stat-label">ƒêang Th·ª±c Hi·ªán</div>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-number">{{ taskStats().completed }}</div>
        <div class="stat-label">ƒê√£ Ho√†n Th√†nh</div>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon">‚è∞</div>
      <div class="stat-content">
        <div class="stat-number">{{ taskStats().overdue }}</div>
        <div class="stat-label">Qu√° H·∫°n</div>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="T√¨m ki·∫øm nhi·ªám v·ª•..."
        [(ngModel)]="searchTerm"
        (input)="filterTasks()"
        class="search-input"
      >
      <span class="search-icon">üîç</span>
    </div>
    
    <div class="filter-options">
      <select [(ngModel)]="statusFilter" (change)="filterTasks()" class="filter-select" title="L·ªçc theo tr·∫°ng th√°i">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="todo">Ch∆∞a b·∫Øt ƒë·∫ßu</option>
        <option value="in-progress">ƒêang th·ª±c hi·ªán</option>
        <option value="done">Ho√†n th√†nh</option>
      </select>
      
      <select [(ngModel)]="priorityFilter" (change)="filterTasks()" class="filter-select" title="L·ªçc theo ƒë·ªô ∆∞u ti√™n">
        <option value="">T·∫•t c·∫£ ƒë·ªô ∆∞u ti√™n</option>
        <option value="high">Cao</option>
        <option value="medium">Trung b√¨nh</option>
        <option value="low">Th·∫•p</option>
      </select>
      
      <select [(ngModel)]="projectFilter" (change)="filterTasks()" class="filter-select" title="L·ªçc theo d·ª± √°n">
        <option value="">T·∫•t c·∫£ d·ª± √°n</option>
        <option *ngFor="let project of projects()" [value]="project">{{ project }}</option>
      </select>
    </div>
  </div>

  <!-- Kanban Board -->
  <div class="kanban-board">
    <!-- To Do Column -->
    <div class="kanban-column">
      <div class="kanban-header">
        <h3>To Do</h3>
        <span class="count">{{ todoTasks().length }}</span>
      </div>
      <div cdkDropList #todoList="cdkDropList" [cdkDropListData]="todoTasks()" [cdkDropListConnectedTo]="[inProgressList, reviewList, doneList]" class="kanban-list" (cdkDropListDropped)="onDrop($event, 'todo')">
        <div class="simple-card" *ngFor="let task of todoTasks()" cdkDrag>
          <div class="top">
            <div class="title">{{ task.title }}</div>
            <span class="pill" [class]="'priority-' + task.priority">{{ getPriorityText(task.priority) }}</span>
          </div>
          <div class="meta">
            <span class="date" [class.overdue]="isOverdue(task.dueDate)">‚è∞ {{ task.dueDate }}</span>
            <button class="btn btn-outline" (click)="openDetail(task)">Chi ti·∫øt</button>
          </div>
        </div>
      </div>
    </div>

    <!-- In Progress Column -->
    <div class="kanban-column">
      <div class="kanban-header">
        <h3>In Progress</h3>
        <span class="count">{{ inProgressTasks().length }}</span>
      </div>
      <div cdkDropList #inProgressList="cdkDropList" [cdkDropListData]="inProgressTasks()" [cdkDropListConnectedTo]="[todoList, reviewList, doneList]" class="kanban-list" (cdkDropListDropped)="onDrop($event, 'in-progress')">
        <div class="simple-card" *ngFor="let task of inProgressTasks()" cdkDrag>
          <div class="top">
            <div class="title">{{ task.title }}</div>
            <span class="pill" [class]="'priority-' + task.priority">{{ getPriorityText(task.priority) }}</span>
          </div>
          <div class="meta">
            <span class="date" [class.overdue]="isOverdue(task.dueDate)">‚è∞ {{ task.dueDate }}</span>
            <button class="btn btn-outline" (click)="openDetail(task)">Chi ti·∫øt</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Review Column -->
    <div class="kanban-column">
      <div class="kanban-header">
        <h3>Review</h3>
        <span class="count">{{ reviewTasks().length }}</span>
      </div>
      <div cdkDropList #reviewList="cdkDropList" [cdkDropListData]="reviewTasks()" [cdkDropListConnectedTo]="[todoList, inProgressList, doneList]" class="kanban-list" (cdkDropListDropped)="onDrop($event, 'review')">
        <div class="simple-card" *ngFor="let task of reviewTasks()" cdkDrag>
          <div class="top">
            <div class="title">{{ task.title }}</div>
            <span class="pill" [class]="'priority-' + task.priority">{{ getPriorityText(task.priority) }}</span>
          </div>
          <div class="meta">
            <span class="date" [class.overdue]="isOverdue(task.dueDate)">‚è∞ {{ task.dueDate }}</span>
            <button class="btn btn-outline" (click)="openDetail(task)">Chi ti·∫øt</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Done Column -->
    <div class="kanban-column">
      <div class="kanban-header">
        <h3>Done</h3>
        <span class="count">{{ doneTasks().length }}</span>
      </div>
      <div cdkDropList #doneList="cdkDropList" [cdkDropListData]="doneTasks()" [cdkDropListConnectedTo]="[todoList, inProgressList, reviewList]" class="kanban-list" (cdkDropListDropped)="onDrop($event, 'done')">
        <div class="simple-card" *ngFor="let task of doneTasks()" cdkDrag>
          <div class="top">
            <div class="title">{{ task.title }}</div>
            <span class="pill" [class]="'priority-' + task.priority">{{ getPriorityText(task.priority) }}</span>
          </div>
          <div class="meta">
            <span class="date" [class.overdue]="isOverdue(task.dueDate)">‚è∞ {{ task.dueDate }}</span>
            <button class="btn btn-outline" (click)="openDetail(task)">Chi ti·∫øt</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="filteredTasks().length === 0" class="empty-state">
    <div class="empty-icon">‚úÖ</div>
    <h3>Kh√¥ng c√≥ nhi·ªám v·ª• n√†o</h3>
    <p>{{ searchTerm || statusFilter || priorityFilter || projectFilter ? 'Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ƒë·ªÉ xem k·∫øt qu·∫£ kh√°c' : 'B·∫°n ch∆∞a c√≥ nhi·ªám v·ª• n√†o ƒë∆∞·ª£c giao' }}</p>
    <button class="btn btn-primary" (click)="createTask()">
      <span class="btn-icon">‚ûï</span>
      T·∫°o Nhi·ªám V·ª• ƒê·∫ßu Ti√™n
    </button>
  </div>

  <!-- Quick Actions Panel -->
  <div class="quick-actions-panel">
    <div class="panel-header">
      <h3>Thao T√°c Nhanh</h3>
    </div>
    <div class="panel-content">
      <button class="quick-action-btn" (click)="viewMyTasks()">
        <span class="action-icon">üë§</span>
        <span class="action-text">Nhi·ªám V·ª• C·ªßa T√¥i</span>
      </button>
      <button class="quick-action-btn" (click)="viewOverdueTasks()">
        <span class="action-icon">‚è∞</span>
        <span class="action-text">Nhi·ªám V·ª• Qu√° H·∫°n</span>
      </button>
      <button class="quick-action-btn" (click)="exportTasks()">
        <span class="action-icon">üì§</span>
        <span class="action-text">Xu·∫•t B√°o C√°o</span>
      </button>
    </div>
  </div>

  <!-- Edit Status Modal -->
  <div class="modal-backdrop" *ngIf="isEditModalOpen" (click)="closeEditStatusModal()"></div>
  <div class="modal" *ngIf="isEditModalOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>Ch·ªçn tr·∫°ng th√°i</h3>
      <button class="icon-btn" (click)="closeEditStatusModal()">‚úñ</button>
    </div>
    <div class="modal-body">
      <div class="modal-row">
        <label class="radio-option">
          <input type="radio" name="status" value="todo" [(ngModel)]="editStatus">
          <span class="status-badge todo">Ch∆∞a b·∫Øt ƒë·∫ßu</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="status" value="in-progress" [(ngModel)]="editStatus">
          <span class="status-badge in-progress">ƒêang th·ª±c hi·ªán</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="status" value="done" [(ngModel)]="editStatus">
          <span class="status-badge done">Ho√†n th√†nh</span>
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeEditStatusModal()">H·ªßy</button>
      <button class="btn btn-primary" (click)="confirmEditStatus()">L∆∞u</button>
    </div>
  </div>

  <!-- Add Note Modal -->
  <div class="modal-backdrop" *ngIf="isNoteModalOpen" (click)="closeNoteModal()"></div>
  <div class="modal" *ngIf="isNoteModalOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>Th√™m ghi ch√∫</h3>
      <button class="icon-btn" (click)="closeNoteModal()">‚úñ</button>
    </div>
    <div class="modal-body">
      <textarea [(ngModel)]="noteContent" class="note-textarea" rows="6" placeholder="Nh·∫≠p ghi ch√∫ c·ªßa b·∫°n..."></textarea>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeNoteModal()">H·ªßy</button>
      <button class="btn btn-primary" (click)="confirmAddNote()" [disabled]="!noteContent.trim()">L∆∞u</button>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal-backdrop" *ngIf="isDetailModalOpen" (click)="closeDetail()"></div>
  <div class="modal detail-modal" *ngIf="isDetailModalOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>Chi ti·∫øt nhi·ªám v·ª• - {{ detailTask?.title }}</h3>
      <button class="icon-btn" (click)="closeDetail()">‚úñ</button>
    </div>
    <div class="modal-body">
      <div class="info-grid">
        <div class="detail-row"><strong>Deadline:</strong> {{ detailTask?.dueDate }}</div>
        <div class="detail-row"><strong>D·ª± √°n:</strong> {{ detailTask?.project }}</div>
      </div>

      <div class="section-title">Files</div>
      <div class="detail-row" *ngIf="detailTask?.attachments?.length">
        <ul class="attach-list">
          <li *ngFor="let f of detailTask?.attachments">üìé {{ f }}</li>
        </ul>
      </div>
      <div class="detail-actions">
        <label class="upload-btn">
          <input type="file" (change)="onSelectFile($event)" hidden>
          <span>+ Add file</span>
        </label>
      </div>

      <div class="section-title">Ghi ch√∫</div>
      <div class="add-note">
        <textarea class="note-area" [(ngModel)]="detailNoteContent" rows="5" placeholder="Th√™m ghi ch√∫..."></textarea>
        <div class="note-actions">
          <button class="btn btn-primary" (click)="addDetailNote()" [disabled]="!detailNoteContent.trim()">Th√™m note</button>
        </div>
      </div>

      <div class="section-title" *ngIf="(detailTask?.comments || []).length">L·ªãch s·ª≠ ghi ch√∫</div>
      <div class="notes-list" *ngIf="(detailTask?.comments || []).length">
        <div class="note-item" *ngFor="let c of (detailTask?.comments || []).slice().reverse()">
          <div class="note-head"><span class="author">{{ c.author }}</span><span class="time">{{ c.timestamp }}</span></div>
          <div class="note-content">{{ c.content }}</div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" (click)="closeDetail()">ƒê√≥ng</button>
    </div>
  </div>
</div>
