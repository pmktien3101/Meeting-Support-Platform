<div class="tasks-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Qu·∫£n L√Ω Nhi·ªám V·ª•</h1>
      <p class="page-subtitle">Theo d√µi v√† c·∫≠p nh·∫≠t ti·∫øn ƒë·ªô c√¥ng vi·ªác c·ªßa b·∫°n</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="refreshTasks()">
        <span class="btn-icon">üîÑ</span>
        L√†m M·ªõi
      </button>
      <button class="btn btn-primary" (click)="createTask()">
        <span class="btn-icon">‚ûï</span>
        T·∫°o Nhi·ªám V·ª•
      </button>
    </div>
  </div>

  <!-- Task Stats -->
  <div class="task-stats">
    <div class="stat-item">
      <div class="stat-icon">üìã</div>
      <div class="stat-content">
        <div class="stat-number">{{ taskStats().total }}</div>
        <div class="stat-label">T·ªïng Nhi·ªám V·ª•</div>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon">‚è≥</div>
      <div class="stat-content">
        <div class="stat-number">{{ taskStats().inProgress }}</div>
        <div class="stat-label">ƒêang Th·ª±c Hi·ªán</div>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-number">{{ taskStats().completed }}</div>
        <div class="stat-label">ƒê√£ Ho√†n Th√†nh</div>
      </div>
    </div>
    <div class="stat-item">
      <div class="stat-icon">‚è∞</div>
      <div class="stat-content">
        <div class="stat-number">{{ taskStats().overdue }}</div>
        <div class="stat-label">Qu√° H·∫°n</div>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="T√¨m ki·∫øm nhi·ªám v·ª•..."
        [(ngModel)]="searchTerm"
        (input)="filterTasks()"
        class="search-input"
      >
      <span class="search-icon">üîç</span>
    </div>
    
    <div class="filter-options">
      <select [(ngModel)]="statusFilter" (change)="filterTasks()" class="filter-select" title="L·ªçc theo tr·∫°ng th√°i">
        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
        <option value="todo">Ch∆∞a b·∫Øt ƒë·∫ßu</option>
        <option value="in-progress">ƒêang th·ª±c hi·ªán</option>
        <option value="done">Ho√†n th√†nh</option>
      </select>
      
      <select [(ngModel)]="priorityFilter" (change)="filterTasks()" class="filter-select" title="L·ªçc theo ƒë·ªô ∆∞u ti√™n">
        <option value="">T·∫•t c·∫£ ƒë·ªô ∆∞u ti√™n</option>
        <option value="high">Cao</option>
        <option value="medium">Trung b√¨nh</option>
        <option value="low">Th·∫•p</option>
      </select>
      
      <select [(ngModel)]="projectFilter" (change)="filterTasks()" class="filter-select" title="L·ªçc theo d·ª± √°n">
        <option value="">T·∫•t c·∫£ d·ª± √°n</option>
        <option *ngFor="let project of projects()" [value]="project">{{ project }}</option>
      </select>
    </div>
  </div>

  <!-- Tasks List -->
  <div class="tasks-container">
    <div class="tasks-list">
      <div 
        *ngFor="let task of filteredTasks()" 
        class="task-card"
        [class]="'priority-' + task.priority + ' status-' + task.status"
      >
        <div class="task-header">
          <div class="task-title-section">
            <h3 class="task-title">{{ task.title }}</h3>
            <span class="task-project">{{ task.project }}</span>
          </div>
          <div class="task-meta">
            <span class="task-priority" [class]="'priority-' + task.priority">
              {{ getPriorityText(task.priority) }}
            </span>
            <span class="task-status" [class]="task.status">
              {{ getStatusText(task.status) }}
            </span>
          </div>
        </div>
        
        <div class="task-details">
          <p class="task-description">{{ task.description }}</p>
          
          <div class="task-info-grid">
            <div class="info-item">
              <span class="info-label">üë§ Ng∆∞·ªùi th·ª±c hi·ªán:</span>
              <span class="info-value">{{ task.assignee }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">‚è∞ ƒê·∫øn h·∫°n:</span>
              <span class="info-value" [class.overdue]="isOverdue(task.dueDate)">
                {{ task.dueDate }}
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">‚è±Ô∏è ∆Ø·ªõc t√≠nh:</span>
              <span class="info-value">{{ task.estimatedHours }}h</span>
            </div>
            <div class="info-item" *ngIf="task.actualHours">
              <span class="info-label">‚è±Ô∏è Th·ª±c t·∫ø:</span>
              <span class="info-value">{{ task.actualHours }}h</span>
            </div>
          </div>
          
          <div class="task-tags" *ngIf="task.tags.length > 0">
            <span 
              *ngFor="let tag of task.tags" 
              class="task-tag"
            >
              {{ tag }}
            </span>
          </div>
        </div>
        
        <div class="task-actions">
          <div class="action-buttons">
            <button 
              class="btn btn-status"
              [class.todo]="task.status === 'todo'"
              [class.in-progress]="task.status === 'in-progress'"
              [class.done]="task.status === 'done'"
              [attr.disabled]="true"
              title="Tr·∫°ng th√°i hi·ªán t·∫°i"
            >
              <span class="btn-icon">üìå</span>
              {{ getStatusText(task.status) }}
            </button>
            
            <button 
              class="btn btn-outline"
              (click)="editTask(task)"
            >
              <span class="btn-icon">‚úèÔ∏è</span>
              Ch·ªçn Tr·∫°ng Th√°i
            </button>
            
            <button 
              class="btn btn-outline"
              (click)="addComment(task)"
            >
              <span class="btn-icon">üí¨</span>
              Th√™m Ghi Ch√∫
            </button>
          </div>
          
          <div class="task-progress">
            <div class="progress-info">
              <span class="progress-text">Ti·∫øn ƒë·ªô</span>
              <span class="progress-percentage">{{ getProgressPercentage(task) }}%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="getProgressPercentage(task)"></div>
            </div>
          </div>
        </div>
        
        <!-- Task Comments -->
        <div *ngIf="task.comments.length > 0" class="task-comments">
          <div class="comments-header">
            <h4>Ghi Ch√∫ ({{ task.comments.length }})</h4>
          </div>
          
          <div class="comments-list">
            <div 
              *ngFor="let comment of task.comments.slice(-3)" 
              class="comment-item"
            >
              <div class="comment-header">
                <span class="comment-author">{{ comment.author }}</span>
                <span class="comment-time">{{ comment.timestamp }}</span>
              </div>
              <p class="comment-content">{{ comment.content }}</p>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="filteredTasks().length === 0" class="empty-state">
        <div class="empty-icon">‚úÖ</div>
        <h3>Kh√¥ng c√≥ nhi·ªám v·ª• n√†o</h3>
        <p>{{ searchTerm || statusFilter || priorityFilter || projectFilter ? 'Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ƒë·ªÉ xem k·∫øt qu·∫£ kh√°c' : 'B·∫°n ch∆∞a c√≥ nhi·ªám v·ª• n√†o ƒë∆∞·ª£c giao' }}</p>
        <button class="btn btn-primary" (click)="createTask()">
          <span class="btn-icon">‚ûï</span>
          T·∫°o Nhi·ªám V·ª• ƒê·∫ßu Ti√™n
        </button>
      </div>
    </div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="quick-actions-panel">
    <div class="panel-header">
      <h3>Thao T√°c Nhanh</h3>
    </div>
    <div class="panel-content">
      <button class="quick-action-btn" (click)="viewMyTasks()">
        <span class="action-icon">üë§</span>
        <span class="action-text">Nhi·ªám V·ª• C·ªßa T√¥i</span>
      </button>
      <button class="quick-action-btn" (click)="viewOverdueTasks()">
        <span class="action-icon">‚è∞</span>
        <span class="action-text">Nhi·ªám V·ª• Qu√° H·∫°n</span>
      </button>
      <button class="quick-action-btn" (click)="exportTasks()">
        <span class="action-icon">üì§</span>
        <span class="action-text">Xu·∫•t B√°o C√°o</span>
      </button>
    </div>
  </div>

  <!-- Edit Status Modal -->
  <div class="modal-backdrop" *ngIf="isEditModalOpen" (click)="closeEditStatusModal()"></div>
  <div class="modal" *ngIf="isEditModalOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>Ch·ªçn tr·∫°ng th√°i</h3>
      <button class="icon-btn" (click)="closeEditStatusModal()">‚úñ</button>
    </div>
    <div class="modal-body">
      <div class="modal-row">
        <label class="radio-option">
          <input type="radio" name="status" value="todo" [(ngModel)]="editStatus">
          <span class="status-badge todo">Ch∆∞a b·∫Øt ƒë·∫ßu</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="status" value="in-progress" [(ngModel)]="editStatus">
          <span class="status-badge in-progress">ƒêang th·ª±c hi·ªán</span>
        </label>
        <label class="radio-option">
          <input type="radio" name="status" value="done" [(ngModel)]="editStatus">
          <span class="status-badge done">Ho√†n th√†nh</span>
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeEditStatusModal()">H·ªßy</button>
      <button class="btn btn-primary" (click)="confirmEditStatus()">L∆∞u</button>
    </div>
  </div>

  <!-- Add Note Modal -->
  <div class="modal-backdrop" *ngIf="isNoteModalOpen" (click)="closeNoteModal()"></div>
  <div class="modal" *ngIf="isNoteModalOpen" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h3>Th√™m ghi ch√∫</h3>
      <button class="icon-btn" (click)="closeNoteModal()">‚úñ</button>
    </div>
    <div class="modal-body">
      <textarea [(ngModel)]="noteContent" class="note-textarea" rows="6" placeholder="Nh·∫≠p ghi ch√∫ c·ªßa b·∫°n..."></textarea>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="closeNoteModal()">H·ªßy</button>
      <button class="btn btn-primary" (click)="confirmAddNote()" [disabled]="!noteContent.trim()">L∆∞u</button>
    </div>
  </div>
</div>
