<div class="pm-layout">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed()">
    <div class="sidebar-header">
      <div class="logo">
        <span class="logo-icon">üìä</span>
        <span class="logo-text" *ngIf="!sidebarCollapsed()">PM Portal</span>
      </div>
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <span *ngIf="!sidebarCollapsed()">‚óÄ</span>
        <span *ngIf="sidebarCollapsed()">‚ñ∂</span>
      </button>
    </div>

    <nav class="sidebar-nav">
      <ul class="nav-list">
        <li class="nav-item" *ngFor="let item of menuItems">
          <a [routerLink]="item.route" 
             routerLinkActive="active"
             class="nav-link"
             [title]="item.label">
            <span class="nav-icon">{{ item.icon }}</span>
            <span class="nav-label" *ngIf="!sidebarCollapsed()">{{ item.label }}</span>
            <span class="nav-badge" *ngIf="!sidebarCollapsed() && item.badge">{{ item.badge }}</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1 class="page-title">{{ getPageTitle() }}</h1>
        <nav class="breadcrumb" *ngIf="getBreadcrumb()">
          <a *ngFor="let item of getBreadcrumb()" 
             [routerLink]="item.route" 
             class="breadcrumb-item">
            {{ item.label }}
          </a>
        </nav>
      </div>

      <div class="header-right">
        <!-- Notifications -->
        <div class="notifications-dropdown">
          <button class="notifications-toggle" 
                  (click)="toggleNotifications()"
                  [class.has-unread]="hasUnreadNotifications()">
            <span class="notifications-icon">üîî</span>
            <span class="notifications-badge" *ngIf="getUnreadCount() > 0">
              {{ getUnreadCount() }}
            </span>
          </button>
          
          <div class="notifications-panel" *ngIf="notificationsOpen()">
            <div class="notifications-header">
              <h3>Th√¥ng b√°o</h3>
              <button class="mark-all-read" (click)="markAllAsRead()">
                ƒê√°nh d·∫•u t·∫•t c·∫£ ƒë√£ ƒë·ªçc
              </button>
            </div>
            <div class="notifications-list">
              <div class="notification-item" 
                   *ngFor="let notification of notifications"
                   [class.unread]="!notification.read"
                   (click)="markAsRead(notification.id)">
                <span class="notification-icon">{{ notification.icon }}</span>
                <div class="notification-content">
                  <h4>{{ notification.title }}</h4>
                  <p>{{ notification.message }}</p>
                  <span class="notification-time">{{ notification.time }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- User Menu -->
        <div class="user-menu">
          <button class="user-toggle" (click)="toggleUserMenu()">
            <div class="user-avatar">{{ currentUser().avatar }}</div>
            <div class="user-info" *ngIf="!sidebarCollapsed()">
              <span class="user-name">{{ currentUser().name }}</span>
              <span class="user-role">{{ currentUser().role }}</span>
            </div>
            <span class="user-arrow">‚ñº</span>
          </button>
          
          <div class="user-panel" *ngIf="userMenuOpen()">
            <div class="user-panel-header">
              <div class="user-avatar">{{ currentUser().avatar }}</div>
              <div class="user-info">
                <span class="user-name">{{ currentUser().name }}</span>
                <span class="user-email">{{ currentUser().email }}</span>
              </div>
            </div>
            <ul class="user-menu-list">
              <li><button (click)="openProfile()">üë§ H·ªì s∆°</button></li>
              <li><button (click)="openSettings()">‚öôÔ∏è C√†i ƒë·∫∑t</button></li>
              <li><button (click)="openHelp()">‚ùì Tr·ª£ gi√∫p</button></li>
              <li class="divider"></li>
              <li><button (click)="logout()" class="logout-btn">üö™ ƒêƒÉng xu·∫•t</button></li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <div class="page-content">
      <router-outlet></router-outlet>
    </div>
  </main>

  <!-- Modals -->
  <!-- Create Project Modal -->
  <div class="modal-overlay" *ngIf="showCreateProjectModal()" (click)="closeCreateProject()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>üìÅ T·∫°o D·ª± √Ån M·ªõi</h3>
        <button class="modal-close" (click)="closeCreateProject()">√ó</button>
      </div>
      <form [formGroup]="projectForm" (ngSubmit)="submitProject()" class="modal-form">
        <div class="form-group">
          <label for="projectName">T√™n d·ª± √°n *</label>
          <input type="text" id="projectName" formControlName="name" placeholder="Nh·∫≠p t√™n d·ª± √°n">
        </div>
        <div class="form-group">
          <label for="projectDescription">M√¥ t·∫£</label>
          <textarea id="projectDescription" formControlName="description" rows="3" placeholder="M√¥ t·∫£ d·ª± √°n"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="startDate">Ng√†y b·∫Øt ƒë·∫ßu *</label>
            <input type="date" id="startDate" formControlName="startDate">
          </div>
          <div class="form-group">
            <label for="endDate">Ng√†y k·∫øt th√∫c *</label>
            <input type="date" id="endDate" formControlName="endDate">
          </div>
        </div>
        <div class="form-group">
          <label for="projectStatus">Tr·∫°ng th√°i</label>
          <select id="projectStatus" formControlName="status">
            <option value="planning">L·∫≠p k·∫ø ho·∫°ch</option>
            <option value="active">ƒêang th·ª±c hi·ªán</option>
            <option value="on-hold">T·∫°m d·ª´ng</option>
            <option value="completed">Ho√†n th√†nh</option>
          </select>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeCreateProject()">H·ªßy</button>
          <button type="submit" class="btn btn-primary" [disabled]="!projectForm.valid">T·∫°o d·ª± √°n</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Meeting Modal -->
  <div class="modal-overlay" *ngIf="showCreateMeetingModal()" (click)="closeCreateMeeting()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>üìÖ T·∫°o Cu·ªôc H·ªçp M·ªõi</h3>
        <button class="modal-close" (click)="closeCreateMeeting()">√ó</button>
      </div>
      <form [formGroup]="meetingForm" (ngSubmit)="submitMeeting()" class="modal-form">
        <div class="form-group">
          <label for="meetingTitle">Ti√™u ƒë·ªÅ cu·ªôc h·ªçp *</label>
          <input type="text" id="meetingTitle" formControlName="title" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ cu·ªôc h·ªçp">
        </div>
        <div class="form-group">
          <label for="meetingDescription">M√¥ t·∫£</label>
          <textarea id="meetingDescription" formControlName="description" rows="3" placeholder="M√¥ t·∫£ cu·ªôc h·ªçp"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="meetingDate">Ng√†y *</label>
            <input type="date" id="meetingDate" formControlName="date">
          </div>
          <div class="form-group">
            <label for="meetingTime">Gi·ªù *</label>
            <input type="time" id="meetingTime" formControlName="time">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="meetingDuration">Th·ªùi l∆∞·ª£ng (ph√∫t) *</label>
            <input type="number" id="meetingDuration" formControlName="duration" min="15" max="480">
          </div>
          <div class="form-group">
            <label for="meetingType">H√¨nh th·ª©c</label>
            <select id="meetingType" formControlName="type">
              <option value="online">Tr·ª±c tuy·∫øn</option>
              <option value="offline">Tr·ª±c ti·∫øp</option>
              <option value="hybrid">K·∫øt h·ª£p</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Ch·ªçn ng∆∞·ªùi tham d·ª±</label>
          <div class="participants-grid">
            <div class="participant-item" 
                 *ngFor="let member of teamMembers"
                 [class.selected]="isParticipantSelected(member.id)"
                 (click)="toggleParticipant(member.id)">
              <span class="participant-avatar">{{ member.avatar }}</span>
              <span class="participant-name">{{ member.name }}</span>
              <span class="participant-role">{{ member.role }}</span>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeCreateMeeting()">H·ªßy</button>
          <button type="submit" class="btn btn-primary" [disabled]="!meetingForm.valid">T·∫°o cu·ªôc h·ªçp</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Create Task Modal -->
  <div class="modal-overlay" *ngIf="showCreateTaskModal()" (click)="closeCreateTask()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>‚úÖ T·∫°o C√¥ng Vi·ªác M·ªõi</h3>
        <button class="modal-close" (click)="closeCreateTask()">√ó</button>
      </div>
      <form [formGroup]="taskForm" (ngSubmit)="submitTask()" class="modal-form">
        <div class="form-group">
          <label for="taskTitle">Ti√™u ƒë·ªÅ c√¥ng vi·ªác *</label>
          <input type="text" id="taskTitle" formControlName="title" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ c√¥ng vi·ªác">
        </div>
        <div class="form-group">
          <label for="taskDescription">M√¥ t·∫£</label>
          <textarea id="taskDescription" formControlName="description" rows="3" placeholder="M√¥ t·∫£ c√¥ng vi·ªác"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="taskAssignee">Ng∆∞·ªùi th·ª±c hi·ªán</label>
            <select id="taskAssignee" formControlName="assigneeId">
              <option value="">Ch·ªçn ng∆∞·ªùi th·ª±c hi·ªán</option>
              <option *ngFor="let member of teamMembers" [value]="member.id">
                {{ member.name }} - {{ member.role }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="taskPriority">M·ª©c ƒë·ªô ∆∞u ti√™n</label>
            <select id="taskPriority" formControlName="priority">
              <option value="low">Th·∫•p</option>
              <option value="medium">Trung b√¨nh</option>
              <option value="high">Cao</option>
              <option value="urgent">Kh·∫©n c·∫•p</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="taskStartDate">Ng√†y b·∫Øt ƒë·∫ßu</label>
            <input type="date" id="taskStartDate" formControlName="startDate">
          </div>
          <div class="form-group">
            <label for="taskDueDate">H·∫°n ho√†n th√†nh</label>
            <input type="date" id="taskDueDate" formControlName="dueDate">
          </div>
        </div>
        <div class="form-group">
          <label for="taskStatus">Tr·∫°ng th√°i</label>
          <select id="taskStatus" formControlName="status">
            <option value="todo">To-do</option>
            <option value="in-progress">ƒêang th·ª±c hi·ªán</option>
            <option value="review">ƒêang review</option>
            <option value="done">Ho√†n th√†nh</option>
          </select>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeCreateTask()">H·ªßy</button>
          <button type="submit" class="btn btn-primary" [disabled]="!taskForm.valid">T·∫°o c√¥ng vi·ªác</button>
        </div>
      </form>
    </div>
  </div>
</div>
