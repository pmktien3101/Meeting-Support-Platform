<div class="milestones-page">
  <div class="page-header">
    <div class="header-content">
      <div class="header-title-section">
        <button *ngIf="isProjectSpecific" class="btn btn-outline btn-sm back-btn" (click)="backToProjects()">
          â† Quay láº¡i Dá»± Ãn
        </button>
        <h2 *ngIf="!isProjectSpecific">ğŸ¯ Quáº£n LÃ½ Milestone</h2>
        <h2 *ngIf="isProjectSpecific">ğŸ¯ Milestones - {{ currentProject?.name }}</h2>
        <p *ngIf="!isProjectSpecific">Theo dÃµi vÃ  quáº£n lÃ½ cÃ¡c milestone cá»§a dá»± Ã¡n</p>
        <p *ngIf="isProjectSpecific">Quáº£n lÃ½ milestones cho dá»± Ã¡n {{ currentProject?.name }}</p>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateMilestone()">
        â• Táº¡o Milestone Má»›i
      </button>
      <button class="btn btn-secondary">
        ğŸ“Š Xem BÃ¡o CÃ¡o
      </button>
    </div>
  </div>

  <!-- Project Info Section (only for project-specific view) -->
  <div *ngIf="isProjectSpecific && currentProject" class="project-info-section">
    <div class="project-info-card">
      <div class="project-info-header">
        <div class="project-icon">ğŸ“</div>
        <div class="project-info">
          <h3>{{ currentProject.name }}</h3>
          <p>{{ currentProject.description }}</p>
        </div>
        <div class="project-status">
          <span class="status-badge" [class]="currentProject.status">
            {{ currentProject.status === 'active' ? 'Äang thá»±c hiá»‡n' : 
               currentProject.status === 'planning' ? 'Láº­p káº¿ hoáº¡ch' : 
               currentProject.status === 'completed' ? 'HoÃ n thÃ nh' : currentProject.status }}
          </span>
        </div>
      </div>
      <div class="project-info-meta">
        <div class="meta-item">
          <span class="meta-icon">ğŸ“…</span>
          <span class="meta-text">
            {{ currentProject.startDate | date:'dd/MM/yyyy' }} - {{ currentProject.endDate | date:'dd/MM/yyyy' }}
          </span>
        </div>
        <div class="meta-item">
          <span class="meta-icon">ğŸ‘¤</span>
          <span class="meta-text">{{ currentProject.manager }}</span>
        </div>
        <div class="meta-item">
          <span class="meta-icon">â°</span>
          <span class="meta-text">Tiáº¿n Ä‘á»™: {{ currentProject.progress }}%</span>
        </div>
      </div>
    </div>

    <!-- Project Members Section -->
    <div class="project-members-section">
      <div class="section-header">
        <h4>ğŸ‘¥ ThÃ nh viÃªn dá»± Ã¡n</h4>
        <span class="member-count">{{ currentProject.members.length }} thÃ nh viÃªn</span>
      </div>
      
      <div class="members-grid">
        <div class="member-card" *ngFor="let member of currentProject.members">
          <div class="member-avatar">{{ member.avatar }}</div>
          <div class="member-info">
            <h5 class="member-name">{{ member.name }}</h5>
            <p class="member-role">{{ member.role }}</p>
            <p class="member-email">{{ member.email }}</p>
          </div>
          <button class="remove-member-btn" 
                  (click)="removeMemberFromProject(currentProject, member.id)"
                  title="XÃ³a thÃ nh viÃªn">
            Ã—
          </button>
        </div>
        
        <!-- Add Member Card -->
        <div class="add-member-card">
          <div class="add-member-content">
            <div class="add-member-icon">+</div>
            <h5>ThÃªm thÃ nh viÃªn</h5>
            <select class="add-member-select" 
                    (change)="onMemberSelect(currentProject, $event)">
              <option value="">Chá»n thÃ nh viÃªn...</option>
              <option *ngFor="let member of getAvailableMembersForProject(currentProject)" 
                      [value]="member.id">
                {{ member.name }} - {{ member.role }}
              </option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Project Documents Section -->
    <div class="project-documents-section">
      <div class="section-header">
        <h4>ğŸ“ CÃ¡c tÃ i liá»‡u cÃ³ liÃªn quan</h4>
        <div class="section-actions">
          <span class="document-count">{{ currentProject.documents.length }} tÃ i liá»‡u</span>
          <button class="btn btn-primary btn-sm" (click)="openAddDocumentModal()">
            <span class="btn-icon">ğŸ“¤</span>
            ThÃªm tÃ i liá»‡u
          </button>
        </div>
      </div>
      
      <div class="documents-grid" *ngIf="currentProject.documents.length > 0; else noDocuments">
        <div class="document-card" *ngFor="let document of currentProject.documents">
          <div class="document-icon">
            <span>{{ getFileIcon(document.fileType) }}</span>
          </div>
          <div class="document-info">
            <h5 class="document-name">{{ document.name }}</h5>
            <p class="document-description">{{ document.description }}</p>
            <div class="document-meta">
              <span class="meta-item">
                <span class="meta-icon">ğŸ‘¤</span>
                {{ document.uploadedBy }}
              </span>
              <span class="meta-item">
                <span class="meta-icon">ğŸ“…</span>
                {{ document.uploadedDate | date:'dd/MM/yyyy' }}
              </span>
              <span class="meta-item">
                <span class="meta-icon">ğŸ“</span>
                {{ document.fileSize }}
              </span>
            </div>
          </div>
          <div class="document-actions">
            <button class="action-btn download-btn" (click)="downloadDocument(document)" title="Táº£i xuá»‘ng">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7,10 12,15 17,10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </button>
            <button class="action-btn delete-btn" (click)="removeDocumentFromProject(document.id)" title="XÃ³a tÃ i liá»‡u">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <ng-template #noDocuments>
        <div class="no-documents">
          <div class="no-documents-icon">ğŸ“</div>
          <h5>ChÆ°a cÃ³ tÃ i liá»‡u nÃ o</h5>
          <p>ThÃªm tÃ i liá»‡u Ä‘áº§u tiÃªn Ä‘á»ƒ chia sáº» thÃ´ng tin dá»± Ã¡n</p>
          <button class="btn btn-primary" (click)="openAddDocumentModal()">
            <span class="btn-icon">ğŸ“¤</span>
            ThÃªm tÃ i liá»‡u Ä‘áº§u tiÃªn
          </button>
        </div>
      </ng-template>
    </div>
  </div>

  <div class="milestones-section-header">
    <h3>ğŸ¯ CÃ¡c milestones hiá»‡n táº¡i</h3>
    <p>Quáº£n lÃ½ vÃ  theo dÃµi tiáº¿n Ä‘á»™ cÃ¡c milestones cá»§a dá»± Ã¡n</p>
  </div>

  <div class="milestones-filters">
    <div class="filter-group">
      <label>Tráº¡ng thÃ¡i:</label>
      <select class="filter-select" aria-label="Lá»c theo tráº¡ng thÃ¡i">
        <option value="">Táº¥t cáº£</option>
        <option value="pending">Chá» thá»±c hiá»‡n</option>
        <option value="in-progress">Äang thá»±c hiá»‡n</option>
        <option value="completed">HoÃ n thÃ nh</option>
        <option value="delayed">Bá»‹ trá»…</option>
      </select>
    </div>
    <div class="filter-group" *ngIf="isProjectSpecific">
      <label>Dá»± Ã¡n:</label>
      <select class="filter-select" aria-label="Lá»c theo dá»± Ã¡n">
        <option value="">Táº¥t cáº£ dá»± Ã¡n</option>
        <option value="1">Website E-commerce</option>
        <option value="2">Mobile App</option>
        <option value="3">CRM System</option>
      </select>
    </div>
    <div class="filter-group">
      <label>TÃ¬m kiáº¿m:</label>
      <input type="text" class="filter-input" placeholder="TÃ¬m kiáº¿m milestone...">
    </div>
  </div>

  <div class="milestones-grid">
    <div class="milestone-card" *ngFor="let milestone of milestones">
      <div class="milestone-header">
        <div class="milestone-icon">ğŸ¯</div>
        <div class="milestone-status">
          <span class="status-badge" [class]="milestone.status">
            {{ getStatusText(milestone.status) }}
          </span>
        </div>
      </div>
      
      <div class="milestone-content">
        <h3 class="milestone-title">{{ milestone.name }}</h3>
        <p class="milestone-description">{{ milestone.description }}</p>
        
        <div class="milestone-meta">
          <div class="meta-item" *ngIf="!isProjectSpecific">
            <span class="meta-icon">ğŸ“</span>
            <span class="meta-text">{{ milestone.projectName }}</span>
          </div>
          <div class="meta-item">
            <span class="meta-icon">ğŸ“…</span>
            <span class="meta-text">
              {{ milestone.startDate | date:'dd/MM/yyyy' }} - {{ milestone.endDate | date:'dd/MM/yyyy' }}
            </span>
          </div>
          <div class="meta-item">
            <span class="meta-icon">ğŸ‘¥</span>
            <span class="meta-text">5 thÃ nh viÃªn</span>
          </div>
        </div>
        
        <div class="milestone-progress">
          <div class="progress-header">
            <span class="progress-label">Tiáº¿n Ä‘á»™</span>
            <span class="progress-percentage">{{ milestone.progress }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="milestone.progress"></div>
          </div>
        </div>
      </div>
      
             <div class="milestone-actions">
         <button class="btn btn-primary btn-sm" (click)="viewMilestoneDetails(milestone)">Xem Chi Tiáº¿t</button>
         <button class="btn btn-secondary btn-sm" (click)="openEditMilestone(milestone)">Chá»‰nh Sá»­a</button>
         <button class="btn btn-outline btn-sm" (click)="openTasksModal(milestone)">
           ğŸ“‹ Tasks ({{ getTasksCount(milestone.id) }})
         </button>
       </div>
    </div>
  </div>

  <div class="milestones-summary">
    <div class="summary-card">
      <div class="summary-icon">ğŸ¯</div>
      <div class="summary-content">
        <h4>Tá»•ng sá»‘ milestone</h4>
        <p class="summary-number">{{ milestones.length }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">ğŸš€</div>
      <div class="summary-content">
        <h4>Äang thá»±c hiá»‡n</h4>
        <p class="summary-number">{{ getInProgressCount() }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">âœ…</div>
      <div class="summary-content">
        <h4>HoÃ n thÃ nh</h4>
        <p class="summary-number">{{ getCompletedCount() }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">â°</div>
      <div class="summary-content">
        <h4>Trung bÃ¬nh hoÃ n thÃ nh</h4>
        <p class="summary-number">{{ getAverageProgress() }}%</p>
      </div>
    </div>
  </div>

  <!-- Add Document Modal -->
  <div class="modal-overlay" *ngIf="showAddDocumentModal" (click)="closeAddDocumentModal()">
    <div class="modal add-document-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-content">
          <div class="header-icon">ğŸ“¤</div>
          <div class="header-text">
            <h3>ThÃªm tÃ i liá»‡u má»›i</h3>
            <p>Upload tÃ i liá»‡u cho dá»± Ã¡n {{ currentProject?.name }}</p>
          </div>
        </div>
        <button class="modal-close" (click)="closeAddDocumentModal()" title="ÄÃ³ng">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <form (ngSubmit)="addDocumentToProject()" class="modal-form">
        <div class="form-section">
          <h4 class="section-title">ğŸ“‹ ThÃ´ng tin tÃ i liá»‡u</h4>
          
          <div class="form-group">
            <label for="documentName">
              <span class="label-icon">ğŸ“</span>
              TÃªn tÃ i liá»‡u <span class="required">*</span>
            </label>
            <input type="text" 
                   id="documentName" 
                   [(ngModel)]="documentName" 
                   name="documentName"
                   placeholder="Nháº­p tÃªn tÃ i liá»‡u"
                   class="form-input"
                   required>
          </div>
          
          <div class="form-group">
            <label for="documentDescription">
              <span class="label-icon">ğŸ“„</span>
              MÃ´ táº£ tÃ i liá»‡u
            </label>
            <textarea id="documentDescription" 
                      [(ngModel)]="documentDescription" 
                      name="documentDescription"
                      rows="3" 
                      placeholder="MÃ´ táº£ chi tiáº¿t vá» tÃ i liá»‡u..."
                      class="form-textarea"></textarea>
          </div>
        </div>

        <div class="form-section">
          <h4 class="section-title">ğŸ“ Chá»n file</h4>
          
          <div class="form-group">
            <label for="documentFile">
              <span class="label-icon">ğŸ“</span>
              File tÃ i liá»‡u <span class="required">*</span>
            </label>
            <div class="file-upload-area" [class.has-file]="selectedFile">
              <input type="file" 
                     id="documentFile" 
                     (change)="onFileSelected($event)"
                     class="file-input"
                     accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.png,.jpg,.jpeg,.gif,.zip,.rar,.txt"
                     required>
              <div class="upload-content">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">
                  <h5 *ngIf="!selectedFile">Chá»n file hoáº·c kÃ©o tháº£ vÃ o Ä‘Ã¢y</h5>
                  <h5 *ngIf="selectedFile">{{ selectedFile.name }}</h5>
                  <p *ngIf="!selectedFile">Há»— trá»£: PDF, DOC, DOCX, XLS, XLSX, PPT, PPTX, PNG, JPG, ZIP, RAR, TXT</p>
                  <p *ngIf="selectedFile">KÃ­ch thÆ°á»›c: {{ formatFileSize(selectedFile.size) }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeAddDocumentModal()">
            <span class="btn-icon">âŒ</span>
            Há»§y bá»
          </button>
          <button type="submit" 
                  class="btn btn-primary" 
                  [disabled]="!selectedFile || !documentName.trim()">
            <span class="btn-icon">ğŸ’¾</span>
            ThÃªm tÃ i liá»‡u
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tasks Modal -->
  <div class="modal-overlay" *ngIf="showTasksModal" (click)="closeTasksModal()">
    <div class="modal tasks-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-content">
          <div class="header-icon">ğŸ“‹</div>
          <div class="header-text">
            <h3>Tasks - {{ selectedMilestone?.name }}</h3>
            <p>Quáº£n lÃ½ cÃ¡c tasks cá»§a milestone</p>
          </div>
        </div>
        <button class="modal-close" (click)="closeTasksModal()" title="ÄÃ³ng">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <div class="modal-content">
        <div class="tasks-header">
          <div class="tasks-summary">
            <span class="summary-item">
              <span class="summary-icon">ğŸ“‹</span>
              Tá»•ng: {{ getTasksCountSafe(selectedMilestone?.id) }}
            </span>
            <span class="summary-item">
              <span class="summary-icon">âœ…</span>
              HoÃ n thÃ nh: {{ getCompletedTasksCountSafe(selectedMilestone?.id) }}
            </span>
                         <span class="summary-item">
               <span class="summary-icon">â³</span>
               Äang thá»±c hiá»‡n: {{ getInProgressTasksCountSafe(selectedMilestone?.id) }}
             </span>
          </div>
          <button class="btn btn-primary btn-sm" (click)="openAddTaskModal()">
            <span class="btn-icon">â•</span>
            ThÃªm Task
          </button>
        </div>

        <div class="tasks-list" *ngIf="getTasksForMilestoneSafe(selectedMilestone?.id).length > 0; else noTasks">
          <div class="task-card" *ngFor="let task of getTasksForMilestoneSafe(selectedMilestone?.id)">
            <div class="task-header">
              <div class="task-info">
                <h4 class="task-name">{{ task.name }}</h4>
                <p class="task-description">{{ task.description }}</p>
              </div>
              <div class="task-actions">
                <button class="action-btn delete-btn" (click)="removeTaskFromMilestone(task.id)" title="XÃ³a task">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3,6 5,6 21,6"></polyline>
                    <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                  </svg>
                </button>
              </div>
            </div>
            
            <div class="task-meta">
              <div class="meta-row">
                <div class="meta-item">
                  <span class="meta-label">Tráº¡ng thÃ¡i:</span>
                                     <select class="status-select" 
                           [value]="task.status"
                           (change)="onTaskStatusChange(task.id, $event)">
                     <option value="pending">Chá» thá»±c hiá»‡n</option>
                     <option value="in-progress">Äang thá»±c hiá»‡n</option>
                     <option value="completed">HoÃ n thÃ nh</option>
                     <option value="blocked">Bá»‹ cháº·n</option>
                   </select>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Äá»™ Æ°u tiÃªn:</span>
                  <span class="priority-badge" [style.background-color]="getPriorityColor(task.priority)">
                    {{ getPriorityText(task.priority) }}
                  </span>
                </div>
              </div>
              
              <div class="meta-row">
                <div class="meta-item">
                  <span class="meta-label">NgÆ°á»i thá»±c hiá»‡n:</span>
                  <span class="assignee" *ngIf="task.assignedTo">
                    <span class="assignee-avatar">{{ task.assignedTo.avatar }}</span>
                    {{ task.assignedTo.name }}
                  </span>
                  <span class="no-assignee" *ngIf="!task.assignedTo">ChÆ°a phÃ¢n cÃ´ng</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Háº¡n hoÃ n thÃ nh:</span>
                  <span class="due-date">{{ task.dueDate | date:'dd/MM/yyyy' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <ng-template #noTasks>
          <div class="no-tasks">
            <div class="no-tasks-icon">ğŸ“‹</div>
            <h5>ChÆ°a cÃ³ task nÃ o</h5>
            <p>ThÃªm task Ä‘áº§u tiÃªn Ä‘á»ƒ báº¯t Ä‘áº§u lÃ m viá»‡c</p>
            <button class="btn btn-primary" (click)="openAddTaskModal()">
              <span class="btn-icon">â•</span>
              ThÃªm task Ä‘áº§u tiÃªn
            </button>
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- Add Task Modal -->
  <div class="modal-overlay" *ngIf="showAddTaskModal" (click)="closeAddTaskModal()">
    <div class="modal add-task-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-content">
          <div class="header-icon">â•</div>
          <div class="header-text">
            <h3>ThÃªm Task Má»›i</h3>
            <p>ThÃªm task cho milestone {{ selectedMilestone?.name }}</p>
          </div>
        </div>
        <button class="modal-close" (click)="closeAddTaskModal()" title="ÄÃ³ng">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      
      <form (ngSubmit)="addTaskToMilestone()" class="modal-form">
        <div class="form-section">
          <h4 class="section-title">ğŸ“‹ ThÃ´ng tin task</h4>
          
          <div class="form-group">
            <label for="taskName">
              <span class="label-icon">ğŸ“</span>
              TÃªn task <span class="required">*</span>
            </label>
            <input type="text" 
                   id="taskName" 
                   [(ngModel)]="newTask.name" 
                   name="taskName"
                   placeholder="Nháº­p tÃªn task"
                   class="form-input"
                   required>
          </div>
          
          <div class="form-group">
            <label for="taskDescription">
              <span class="label-icon">ğŸ“„</span>
              MÃ´ táº£ task
            </label>
            <textarea id="taskDescription" 
                      [(ngModel)]="newTask.description" 
                      name="taskDescription"
                      rows="3" 
                      placeholder="MÃ´ táº£ chi tiáº¿t vá» task..."
                      class="form-textarea"></textarea>
          </div>
        </div>

        <div class="form-section">
          <h4 class="section-title">âš™ï¸ CÃ i Ä‘áº·t task</h4>
          
          <div class="form-row">
            <div class="form-group">
              <label for="taskPriority">
                <span class="label-icon">ğŸ¯</span>
                Äá»™ Æ°u tiÃªn
              </label>
              <select id="taskPriority" 
                      [(ngModel)]="newTask.priority" 
                      name="taskPriority"
                      class="form-select">
                <option value="low">Tháº¥p</option>
                <option value="medium">Trung bÃ¬nh</option>
                <option value="high">Cao</option>
                <option value="urgent">Kháº©n cáº¥p</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="taskDueDate">
                <span class="label-icon">ğŸ“…</span>
                Háº¡n hoÃ n thÃ nh <span class="required">*</span>
              </label>
              <input type="date" 
                     id="taskDueDate" 
                     [(ngModel)]="newTask.dueDate" 
                     name="taskDueDate"
                     class="form-input"
                     required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="taskAssignee">
              <span class="label-icon">ğŸ‘¤</span>
              NgÆ°á»i thá»±c hiá»‡n
            </label>
            <select id="taskAssignee" 
                    [(ngModel)]="newTask.assignedTo" 
                    name="taskAssignee"
                    class="form-select">
              <option [ngValue]="null">ChÆ°a phÃ¢n cÃ´ng</option>
              <option *ngFor="let member of currentProject?.members" [ngValue]="member">
                {{ member.name }} - {{ member.role }}
              </option>
            </select>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeAddTaskModal()">
            <span class="btn-icon">âŒ</span>
            Há»§y bá»
          </button>
          <button type="submit" 
                  class="btn btn-primary" 
                  [disabled]="!newTask.name.trim() || !newTask.dueDate">
            <span class="btn-icon">ğŸ’¾</span>
            ThÃªm task
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Milestone Details Modal -->
  <div class="modal-overlay" *ngIf="showMilestoneDetailsModal" (click)="closeMilestoneDetails()">
    <div class="modal milestone-details-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-content">
          <div class="header-icon">ğŸ¯</div>
          <div class="header-text">
            <h3>Chi Tiáº¿t Milestone</h3>
            <p>{{ selectedMilestoneForDetails?.name }}</p>
          </div>
        </div>
        <button class="modal-close" (click)="closeMilestoneDetails()" title="ÄÃ³ng">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-content" *ngIf="selectedMilestoneForDetails">
        <div class="milestone-details-content">
          <div class="detail-section">
            <h4>ğŸ“‹ ThÃ´ng tin cÆ¡ báº£n</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">TÃªn milestone:</span>
                <span class="detail-value">{{ selectedMilestoneForDetails.name }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">MÃ´ táº£:</span>
                <span class="detail-value">{{ selectedMilestoneForDetails.description || 'KhÃ´ng cÃ³ mÃ´ táº£' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Tráº¡ng thÃ¡i:</span>
                <span class="status-badge" [class]="selectedMilestoneForDetails.status">
                  {{ getStatusText(selectedMilestoneForDetails.status) }}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Äá»™ Æ°u tiÃªn:</span>
                <span class="priority-badge" [class]="selectedMilestoneForDetails.priority">
                  {{ getPriorityText(selectedMilestoneForDetails.priority || 'medium') }}
                </span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4>ğŸ“… Thá»i gian</h4>
            <div class="detail-grid">
              <div class="detail-item">
                <span class="detail-label">NgÃ y báº¯t Ä‘áº§u:</span>
                <span class="detail-value">{{ selectedMilestoneForDetails.startDate | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">NgÃ y káº¿t thÃºc:</span>
                <span class="detail-value">{{ selectedMilestoneForDetails.endDate | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">NgÃ y táº¡o:</span>
                <span class="detail-value">{{ selectedMilestoneForDetails.createdAt | date:'dd/MM/yyyy' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Cáº­p nháº­t láº§n cuá»‘i:</span>
                <span class="detail-value">{{ selectedMilestoneForDetails.updatedAt | date:'dd/MM/yyyy' }}</span>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4>ğŸ“Š Tiáº¿n Ä‘á»™</h4>
            <div class="progress-section">
              <div class="progress-header">
                <span class="progress-label">Tiáº¿n Ä‘á»™ hiá»‡n táº¡i</span>
                <span class="progress-percentage">{{ selectedMilestoneForDetails.progress }}%</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="selectedMilestoneForDetails.progress"></div>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h4>ğŸ“‹ Tasks ({{ getTasksCount(selectedMilestoneForDetails.id) }})</h4>
            <div class="tasks-summary">
              <div class="task-stats">
                <div class="stat-item">
                  <span class="stat-icon">â³</span>
                  <span class="stat-label">Chá» thá»±c hiá»‡n</span>
                  <span class="stat-number">{{ getTasksByStatus(selectedMilestoneForDetails.id, 'pending').length }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-icon">ğŸš€</span>
                  <span class="stat-label">Äang thá»±c hiá»‡n</span>
                  <span class="stat-number">{{ getTasksByStatus(selectedMilestoneForDetails.id, 'in-progress').length }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-icon">âœ…</span>
                  <span class="stat-label">HoÃ n thÃ nh</span>
                  <span class="stat-number">{{ getTasksByStatus(selectedMilestoneForDetails.id, 'completed').length }}</span>
                </div>
              </div>
              <button class="btn btn-primary" (click)="openTasksModal(selectedMilestoneForDetails)">
                <span class="btn-icon">ğŸ‘ï¸</span>
                Xem táº¥t cáº£ tasks
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeMilestoneDetails()">
          <span class="btn-icon">âŒ</span>
          ÄÃ³ng
        </button>
        <button class="btn btn-primary" (click)="openEditMilestone(selectedMilestoneForDetails!)">
          <span class="btn-icon">âœï¸</span>
          Chá»‰nh sá»­a
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Milestone Modal -->
  <div class="modal-overlay" *ngIf="showEditMilestoneModal" (click)="closeEditMilestone()">
    <div class="modal edit-milestone-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-content">
          <div class="header-icon">âœï¸</div>
          <div class="header-text">
            <h3>Chá»‰nh Sá»­a Milestone</h3>
            <p>{{ selectedMilestoneForEdit?.name }}</p>
          </div>
        </div>
        <button class="modal-close" (click)="closeEditMilestone()" title="ÄÃ³ng">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <form (ngSubmit)="saveMilestoneEdit()" class="modal-form">
        <div class="form-section">
          <h4 class="section-title">ğŸ“‹ ThÃ´ng tin cÆ¡ báº£n</h4>
          
          <div class="form-group">
            <label for="milestoneName">
              <span class="label-icon">ğŸ¯</span>
              TÃªn milestone <span class="required">*</span>
            </label>
            <input type="text" 
                   id="milestoneName" 
                   [(ngModel)]="editMilestoneForm.name" 
                   name="milestoneName"
                   placeholder="Nháº­p tÃªn milestone"
                   class="form-input"
                   required>
          </div>
          
          <div class="form-group">
            <label for="milestoneDescription">
              <span class="label-icon">ğŸ“„</span>
              MÃ´ táº£
            </label>
            <textarea id="milestoneDescription" 
                      [(ngModel)]="editMilestoneForm.description" 
                      name="milestoneDescription"
                      rows="3" 
                      placeholder="MÃ´ táº£ chi tiáº¿t vá» milestone..."
                      class="form-textarea"></textarea>
          </div>
        </div>

        <div class="form-section">
          <h4 class="section-title">ğŸ“… Thá»i gian</h4>
          
          <div class="form-row">
            <div class="form-group">
              <label for="milestoneStartDate">
                <span class="label-icon">ğŸ“…</span>
                NgÃ y báº¯t Ä‘áº§u
              </label>
              <input type="date" 
                     id="milestoneStartDate" 
                     [(ngModel)]="editMilestoneForm.startDate" 
                     name="milestoneStartDate"
                     class="form-input">
            </div>
            
            <div class="form-group">
              <label for="milestoneEndDate">
                <span class="label-icon">ğŸ“…</span>
                NgÃ y káº¿t thÃºc
              </label>
              <input type="date" 
                     id="milestoneEndDate" 
                     [(ngModel)]="editMilestoneForm.endDate" 
                     name="milestoneEndDate"
                     class="form-input">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h4 class="section-title">âš™ï¸ CÃ i Ä‘áº·t</h4>
          
          <div class="form-row">
            <div class="form-group">
              <label for="milestoneStatus">
                <span class="label-icon">ğŸ”„</span>
                Tráº¡ng thÃ¡i
              </label>
              <select id="milestoneStatus" 
                      [(ngModel)]="editMilestoneForm.status" 
                      name="milestoneStatus"
                      class="form-select">
                <option value="pending">Chá» thá»±c hiá»‡n</option>
                <option value="in-progress">Äang thá»±c hiá»‡n</option>
                <option value="completed">HoÃ n thÃ nh</option>
                <option value="delayed">Bá»‹ trá»…</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="milestonePriority">
                <span class="label-icon">ğŸ¯</span>
                Äá»™ Æ°u tiÃªn
              </label>
              <select id="milestonePriority" 
                      [(ngModel)]="editMilestoneForm.priority" 
                      name="milestonePriority"
                      class="form-select">
                <option value="low">Tháº¥p</option>
                <option value="medium">Trung bÃ¬nh</option>
                <option value="high">Cao</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" (click)="closeEditMilestone()">
            <span class="btn-icon">âŒ</span>
            Há»§y bá»
          </button>
          <button type="submit" 
                  class="btn btn-primary" 
                  [disabled]="!editMilestoneForm.name.trim()">
            <span class="btn-icon">ğŸ’¾</span>
            LÆ°u thay Ä‘á»•i
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
