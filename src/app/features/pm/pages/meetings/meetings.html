<div class="meetings-page">
  <div class="page-header">
    <div class="header-content">
      <h2>üìÖ Qu·∫£n L√Ω Cu·ªôc H·ªçp</h2>
      <p>L√™n l·ªãch v√† qu·∫£n l√Ω c√°c cu·ªôc h·ªçp d·ª± √°n</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateMeeting()">
        ‚ûï T·∫°o Cu·ªôc H·ªçp M·ªõi
      </button>
      <button class="btn btn-secondary">
        üìä Xem L·ªãch
      </button>
    </div>
  </div>

  <!-- Upcoming Meetings Section -->
  <div class="upcoming-meetings-section" *ngIf="getUpcomingMeetings().length > 0">
    <div class="section-header">
      <h3>üöÄ Cu·ªôc h·ªçp s·∫Øp t·ªõi (7 ng√†y t·ªõi)</h3>
      <span class="upcoming-count">{{ getUpcomingMeetings().length }} cu·ªôc h·ªçp</span>
    </div>
    <div class="upcoming-meetings-grid">
      <div class="upcoming-meeting-card" *ngFor="let meeting of getUpcomingMeetings()">
        <div class="upcoming-meeting-time">
          <div class="time-display">
            <span class="time-hour">{{ meeting.time }}</span>
            <span class="time-date">{{ meeting.date | date:'dd/MM' }}</span>
          </div>
        </div>
        <div class="upcoming-meeting-info">
          <h4>{{ meeting.title }}</h4>
          <div class="meeting-meta">
            <span class="project-badge">{{ meeting.projectName }}</span>
            <span class="duration">{{ meeting.duration }} ph√∫t</span>
            <span class="type-badge" [class]="meeting.type">{{ getTypeText(meeting.type) }}</span>
          </div>
        </div>
        <button class="btn btn-primary btn-sm">Tham Gia</button>
      </div>
    </div>
  </div>

  <!-- Enhanced Filters Section -->
  <div class="meetings-filters-section">
    <div class="filters-header">
      <h3>üîç B·ªô l·ªçc cu·ªôc h·ªçp</h3>
      <button class="btn btn-outline btn-sm" (click)="clearFilters()" *ngIf="selectedProjectFilter || selectedStatusFilter || selectedTypeFilter || searchTerm">
        <span class="btn-icon">üîÑ</span>
        X√≥a b·ªô l·ªçc
      </button>
    </div>
    
    <div class="meetings-filters">
      <div class="filter-group">
        <label>D·ª± √°n:</label>
        <select class="filter-select" 
                [(ngModel)]="selectedProjectFilter"
                aria-label="L·ªçc theo d·ª± √°n">
          <option value="">T·∫•t c·∫£ d·ª± √°n</option>
          <option *ngFor="let project of availableProjects" [value]="project.id">
            {{ project.name }}
          </option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>Tr·∫°ng th√°i:</label>
        <select class="filter-select" 
                [(ngModel)]="selectedStatusFilter"
                aria-label="L·ªçc theo tr·∫°ng th√°i">
          <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
          <option value="scheduled">ƒê√£ l√™n l·ªãch</option>
          <option value="ongoing">ƒêang di·ªÖn ra</option>
          <option value="completed">ƒê√£ ho√†n th√†nh</option>
          <option value="cancelled">ƒê√£ h·ªßy</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>H√¨nh th·ª©c:</label>
        <select class="filter-select" 
                [(ngModel)]="selectedTypeFilter"
                aria-label="L·ªçc theo h√¨nh th·ª©c">
          <option value="">T·∫•t c·∫£ h√¨nh th·ª©c</option>
          <option value="online">Tr·ª±c tuy·∫øn</option>
          <option value="offline">Tr·ª±c ti·∫øp</option>
          <option value="hybrid">K·∫øt h·ª£p</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>S·∫Øp x·∫øp theo:</label>
        <select class="filter-select" 
                [(ngModel)]="sortBy"
                aria-label="S·∫Øp x·∫øp cu·ªôc h·ªçp">
          <option value="date">Th·ªùi gian g·∫ßn nh·∫•t</option>
          <option value="title">T√™n cu·ªôc h·ªçp</option>
          <option value="project">T√™n d·ª± √°n</option>
        </select>
      </div>
      
      <div class="filter-group search-group">
        <label>T√¨m ki·∫øm:</label>
        <input type="text" 
               class="filter-input" 
               [(ngModel)]="searchTerm"
               placeholder="T√¨m ki·∫øm cu·ªôc h·ªçp, d·ª± √°n, milestone...">
      </div>
    </div>
  </div>

  <!-- Meetings Results Section -->
  <div class="meetings-results-section">
    <div class="results-header">
      <h3>üìã Danh s√°ch cu·ªôc h·ªçp</h3>
      <span class="results-count">{{ filteredMeetings.length }} cu·ªôc h·ªçp</span>
    </div>

    <div class="meetings-grid" *ngIf="filteredMeetings.length > 0; else noMeetings">
      <div class="meeting-card" *ngFor="let meeting of filteredMeetings">
        <div class="meeting-header">
          <div class="meeting-icon">üìÖ</div>
          <div class="meeting-status">
            <span class="status-badge" [class]="meeting.status">
              {{ getStatusText(meeting.status) }}
            </span>
          </div>
        </div>
        
        <div class="meeting-content">
          <h3 class="meeting-title">{{ meeting.title }}</h3>
          <p class="meeting-description">{{ meeting.description }}</p>
          
          <!-- Project and Milestone Information -->
          <div class="meeting-project-info">
            <div class="project-info">
              <span class="project-icon">üìÅ</span>
              <span class="project-name">{{ meeting.projectName }}</span>
            </div>
            <div class="milestone-info" *ngIf="meeting.milestoneName">
              <span class="milestone-icon">üéØ</span>
              <span class="milestone-name">{{ meeting.milestoneName }}</span>
            </div>
          </div>
          
          <div class="meeting-details">
            <div class="detail-item">
              <span class="detail-icon">üìÖ</span>
              <span class="detail-text">{{ meeting.date | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">‚è∞</span>
              <span class="detail-text">{{ meeting.time }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">‚è±Ô∏è</span>
              <span class="detail-text">{{ meeting.duration }} ph√∫t</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">üåê</span>
              <span class="detail-text">{{ getTypeText(meeting.type) }}</span>
            </div>
            <div class="detail-item" *ngIf="meeting.location">
              <span class="detail-icon">üìç</span>
              <span class="detail-text">{{ meeting.location }}</span>
            </div>
          </div>
          
          <div class="meeting-participants">
            <span class="participants-label">Ng∆∞·ªùi tham d·ª±:</span>
            <div class="participants-list">
              <span class="participant" *ngFor="let participant of meeting.participants.slice(0, 3)">
                {{ participant }}
              </span>
              <span class="more-participants" *ngIf="meeting.participants.length > 3">
                +{{ meeting.participants.length - 3 }} kh√°c
              </span>
            </div>
          </div>
        </div>
        
        <div class="meeting-actions">
          <button class="btn btn-primary btn-sm" *ngIf="meeting.status === 'scheduled'">Tham Gia</button>
          <button class="btn btn-secondary btn-sm">Ch·ªânh S·ª≠a</button>
          <button class="btn btn-outline btn-sm" 
                  (click)="openMeetingNotes(meeting)"
                  *ngIf="meeting.status === 'completed'"
                  title="Xem ghi ch√∫ cu·ªôc h·ªçp">
            üìã Ghi Ch√∫
          </button>
        </div>
      </div>
    </div>

    <ng-template #noMeetings>
      <div class="no-meetings">
        <div class="no-meetings-icon">üìÖ</div>
        <h4>Kh√¥ng t√¨m th·∫•y cu·ªôc h·ªçp n√†o</h4>
        <p>Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·∫°o cu·ªôc h·ªçp m·ªõi</p>
        <button class="btn btn-primary" (click)="openCreateMeeting()">
          <span class="btn-icon">‚ûï</span>
          T·∫°o cu·ªôc h·ªçp m·ªõi
        </button>
      </div>
    </ng-template>
  </div>

  <div class="meetings-summary">
    <div class="summary-card">
      <div class="summary-icon">üìÖ</div>
      <div class="summary-content">
        <h4>T·ªïng s·ªë cu·ªôc h·ªçp</h4>
        <p class="summary-number">{{ meetings.length }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">üöÄ</div>
      <div class="summary-content">
        <h4>ƒê√£ l√™n l·ªãch</h4>
        <p class="summary-number">{{ getScheduledCount() }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">‚úÖ</div>
      <div class="summary-content">
        <h4>ƒê√£ ho√†n th√†nh</h4>
        <p class="summary-number">{{ getCompletedCount() }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">üë•</div>
      <div class="summary-content">
        <h4>Trung b√¨nh tham d·ª±</h4>
        <p class="summary-number">{{ getAverageParticipants() }}</p>
      </div>
    </div>
  </div>

  <!-- Meeting Notes Modal -->
  <div class="modal-overlay" *ngIf="showNotesModal" (click)="closeMeetingNotes()">
    <div class="modal meeting-notes-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="header-content">
          <div class="header-icon">üìã</div>
          <div class="header-text">
            <h3>Ghi Ch√∫ Cu·ªôc H·ªçp</h3>
            <p>{{ selectedMeetingForNotes?.title }}</p>
          </div>
        </div>
        <button class="modal-close" (click)="closeMeetingNotes()" title="ƒê√≥ng">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-content">
        <!-- Summary Section -->
        <div class="notes-section" *ngIf="meetingNotes?.summary">
          <div class="section-header">
            <h4>üìù T√≥m T·∫Øt Cu·ªôc H·ªçp</h4>
          </div>
          <div class="summary-content">
            <p>{{ meetingNotes!.summary }}</p>
          </div>
        </div>

        <!-- Todo List Section -->
        <div class="notes-section" *ngIf="meetingNotes?.todoList && meetingNotes!.todoList.length > 0">
          <div class="section-header">
            <h4>‚úÖ Danh S√°ch C√¥ng Vi·ªác</h4>
            <span class="todo-count">{{ meetingNotes!.todoList.length }} c√¥ng vi·ªác</span>
          </div>
          <div class="todo-list">
            <div class="todo-item" *ngFor="let todo of meetingNotes!.todoList">
              <div class="todo-content">
                <div class="todo-task">{{ todo.task }}</div>
                <div class="todo-meta">
                  <span class="todo-assignee">üë§ {{ todo.assignee }}</span>
                  <span class="todo-due-date">üìÖ {{ todo.dueDate | date:'dd/MM/yyyy' }}</span>
                  <span class="todo-priority" [style.color]="getPriorityColor(todo.priority)">
                    ‚ö° {{ getPriorityText(todo.priority) }}
                  </span>
                </div>
              </div>
              <div class="todo-status">
                <span class="status-badge" [class]="todo.status">
                  {{ getStatusText(todo.status) }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Manual Notes Section -->
        <div class="notes-section">
          <div class="section-header">
            <h4>üìù Ghi Ch√∫ Th·ªß C√¥ng</h4>
            <span class="notes-count" *ngIf="meetingNotes?.manualNotes">{{ meetingNotes!.manualNotes.length }} ghi ch√∫</span>
          </div>
          
          <!-- Existing Notes -->
          <div class="manual-notes-list" *ngIf="meetingNotes?.manualNotes && meetingNotes!.manualNotes.length > 0">
            <div class="manual-note" *ngFor="let note of meetingNotes!.manualNotes">
              <div class="note-header">
                <span class="note-type-icon">{{ getNoteTypeIcon(note.type) }}</span>
                <span class="note-type">{{ getNoteTypeText(note.type) }}</span>
                <span class="note-author">üë§ {{ note.author }}</span>
                <span class="note-time">{{ note.timestamp | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <div class="note-content">
                {{ note.content }}
              </div>
            </div>
          </div>

          <!-- Add New Note -->
          <div class="add-note-section">
            <h5>‚ûï Th√™m Ghi Ch√∫ M·ªõi</h5>
            <div class="add-note-form">
              <div class="form-group">
                <label>Lo·∫°i ghi ch√∫:</label>
                <select class="form-select" [(ngModel)]="newManualNote.type">
                  <option value="general">üìù Ghi ch√∫ chung</option>
                  <option value="action-item">‚úÖ H√†nh ƒë·ªông</option>
                  <option value="decision">üéØ Quy·∫øt ƒë·ªãnh</option>
                  <option value="question">‚ùì C√¢u h·ªèi</option>
                </select>
              </div>
              <div class="form-group">
                <label>N·ªôi dung:</label>
                <textarea class="form-textarea" 
                          [(ngModel)]="newManualNote.content"
                          placeholder="Nh·∫≠p n·ªôi dung ghi ch√∫..."
                          rows="3"></textarea>
              </div>
              <button class="btn btn-primary btn-sm" 
                      (click)="addManualNote()"
                      [disabled]="!newManualNote.content.trim()">
                <span class="btn-icon">‚ûï</span>
                Th√™m Ghi Ch√∫
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeMeetingNotes()">
          <span class="btn-icon">‚ùå</span>
          ƒê√≥ng
        </button>
      </div>
    </div>
  </div>
</div>
