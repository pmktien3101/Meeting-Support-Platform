<div class="pm-projects">
  <div class="page-header">
    <div class="header-content">
      <h2>ğŸ“ Quáº£n LÃ½ Dá»± Ãn</h2>
      <p>Theo dÃµi vÃ  quáº£n lÃ½ cÃ¡c dá»± Ã¡n cá»§a báº¡n</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateProject()">
        â• Táº¡o Dá»± Ãn Má»›i
      </button>
      <button class="btn btn-secondary">
        ğŸ“Š Xem BÃ¡o CÃ¡o
      </button>
    </div>
  </div>

  <div class="projects-filters">
    <div class="filter-group">
      <label>Tráº¡ng thÃ¡i:</label>
      <select class="filter-select" aria-label="Lá»c theo tráº¡ng thÃ¡i">
        <option value="">Táº¥t cáº£</option>
        <option value="planning">Láº­p káº¿ hoáº¡ch</option>
        <option value="active">Äang thá»±c hiá»‡n</option>
        <option value="on-hold">Táº¡m dá»«ng</option>
        <option value="completed">HoÃ n thÃ nh</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Quáº£n lÃ½:</label>
      <select class="filter-select" aria-label="Lá»c theo quáº£n lÃ½">
        <option value="">Táº¥t cáº£</option>
        <option value="me">Cá»§a tÃ´i</option>
        <option value="team">Cá»§a nhÃ³m</option>
      </select>
    </div>
    <div class="filter-group">
      <label>TÃ¬m kiáº¿m:</label>
      <input type="text" class="filter-input" placeholder="TÃ¬m kiáº¿m dá»± Ã¡n...">
    </div>
  </div>

  <div class="projects-grid">
    <div class="project-card" *ngFor="let project of projects">
      <div class="project-header">
        <div class="project-icon">ğŸ“</div>
        <div class="project-status">
          <span class="status-badge" [class]="project.status">
            {{ getProjectStatusText(project.status) }}
          </span>
        </div>
      </div>
      
      <div class="project-content">
        <h3 class="project-title">{{ project.name }}</h3>
        <p class="project-description">{{ project.description }}</p>
        
        <div class="project-meta">
          <div class="meta-item">
            <span class="meta-icon">ğŸ“…</span>
            <span class="meta-text">
              {{ project.startDate | date:'dd/MM/yyyy' }} - {{ project.endDate | date:'dd/MM/yyyy' }}
            </span>
          </div>
          <div class="meta-item">
            <span class="meta-icon">ğŸ‘¤</span>
            <span class="meta-text">{{ project.manager }}</span>
          </div>
          <div class="meta-item">
            <span class="meta-icon">ğŸ‘¥</span>
            <span class="meta-text">{{ project.members.length }} thÃ nh viÃªn</span>
          </div>
        </div>
        
        <div class="project-progress">
          <div class="progress-header">
            <span class="progress-label">Tiáº¿n Ä‘á»™</span>
            <span class="progress-percentage">{{ project.progress }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="project.progress"></div>
          </div>
        </div>
      </div>
      
      <div class="project-actions">
        <button class="btn btn-primary btn-sm" (click)="viewProjectMilestones(project.id)">Xem Chi Tiáº¿t</button>
        <button class="btn btn-secondary btn-sm" (click)="openEditProject(project)">Chá»‰nh Sá»­a</button>
        <button class="btn btn-outline btn-sm">ğŸ“Š BÃ¡o CÃ¡o</button>
      </div>
    </div>
  </div>

  <div class="projects-summary">
    <div class="summary-card">
      <div class="summary-icon">ğŸ“Š</div>
      <div class="summary-content">
        <h4>Tá»•ng sá»‘ dá»± Ã¡n</h4>
        <p class="summary-number">{{ projects.length }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">ğŸš€</div>
      <div class="summary-content">
        <h4>Äang thá»±c hiá»‡n</h4>
        <p class="summary-number">{{ getActiveProjectsCount() }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">âœ…</div>
      <div class="summary-content">
        <h4>HoÃ n thÃ nh</h4>
        <p class="summary-number">{{ getCompletedProjectsCount() }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">â°</div>
      <div class="summary-content">
        <h4>Trung bÃ¬nh hoÃ n thÃ nh</h4>
        <p class="summary-number">{{ getAverageProgress() }}%</p>
      </div>
    </div>
  </div>
</div>

<!-- Edit Project Modal -->
<div class="modal-overlay" *ngIf="showEditProjectModal" (click)="closeEditProject()">
  <div class="modal edit-project-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">âœï¸</div>
        <div class="header-text">
          <h3>Chá»‰nh Sá»­a Dá»± Ãn</h3>
          <p>Cáº­p nháº­t thÃ´ng tin dá»± Ã¡n {{ selectedProject?.name }}</p>
        </div>
      </div>
      <button class="modal-close" (click)="closeEditProject()" title="ÄÃ³ng">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <form [formGroup]="editProjectForm" (ngSubmit)="submitEditProject()" class="modal-form">
      <div class="form-section">
        <h4 class="section-title">ğŸ“‹ ThÃ´ng tin cÆ¡ báº£n</h4>
        
        <div class="form-group">
          <label for="editProjectName">
            <span class="label-icon">ğŸ“</span>
            TÃªn dá»± Ã¡n <span class="required">*</span>
          </label>
          <input type="text" 
                 id="editProjectName" 
                 formControlName="name" 
                 placeholder="Nháº­p tÃªn dá»± Ã¡n"
                 class="form-input">
          <div class="error-message" *ngIf="editProjectForm.get('name')?.invalid && editProjectForm.get('name')?.touched">
            <span class="error-icon">âš ï¸</span>
            TÃªn dá»± Ã¡n pháº£i cÃ³ Ã­t nháº¥t 3 kÃ½ tá»±
          </div>
        </div>
        
        <div class="form-group">
          <label for="editProjectDescription">
            <span class="label-icon">ğŸ“„</span>
            MÃ´ táº£ dá»± Ã¡n <span class="required">*</span>
          </label>
          <textarea id="editProjectDescription" 
                    formControlName="description" 
                    rows="4" 
                    placeholder="MÃ´ táº£ chi tiáº¿t vá» dá»± Ã¡n..."
                    class="form-textarea"></textarea>
          <div class="error-message" *ngIf="editProjectForm.get('description')?.invalid && editProjectForm.get('description')?.touched">
            <span class="error-icon">âš ï¸</span>
            MÃ´ táº£ dá»± Ã¡n lÃ  báº¯t buá»™c
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">ğŸ“… Thá»i gian dá»± Ã¡n</h4>
        
        <div class="form-row">
          <div class="form-group">
            <label for="editStartDate">
              <span class="label-icon">ğŸš€</span>
              NgÃ y báº¯t Ä‘áº§u <span class="required">*</span>
            </label>
            <input type="date" 
                   id="editStartDate" 
                   formControlName="startDate"
                   class="form-input">
            <div class="error-message" *ngIf="editProjectForm.get('startDate')?.invalid && editProjectForm.get('startDate')?.touched">
              <span class="error-icon">âš ï¸</span>
              NgÃ y báº¯t Ä‘áº§u lÃ  báº¯t buá»™c
            </div>
          </div>
          <div class="form-group">
            <label for="editEndDate">
              <span class="label-icon">ğŸ</span>
              NgÃ y káº¿t thÃºc <span class="required">*</span>
            </label>
            <input type="date" 
                   id="editEndDate" 
                   formControlName="endDate"
                   class="form-input">
            <div class="error-message" *ngIf="editProjectForm.get('endDate')?.invalid && editProjectForm.get('endDate')?.touched">
              <span class="error-icon">âš ï¸</span>
              NgÃ y káº¿t thÃºc lÃ  báº¯t buá»™c
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">ğŸ“Š Tráº¡ng thÃ¡i dá»± Ã¡n</h4>
        
        <div class="form-group">
          <label for="editProjectStatus">
            <span class="label-icon">ğŸ¯</span>
            Tráº¡ng thÃ¡i <span class="required">*</span>
          </label>
          <div class="status-select-wrapper">
            <select id="editProjectStatus" formControlName="status" class="form-select">
              <option value="planning">ğŸ“‹ Láº­p káº¿ hoáº¡ch</option>
              <option value="active">ğŸš€ Äang thá»±c hiá»‡n</option>
              <option value="on-hold">â¸ï¸ Táº¡m dá»«ng</option>
              <option value="completed">âœ… HoÃ n thÃ nh</option>
            </select>
            <div class="select-arrow">â–¼</div>
          </div>
          <div class="error-message" *ngIf="editProjectForm.get('status')?.invalid && editProjectForm.get('status')?.touched">
            <span class="error-icon">âš ï¸</span>
            Tráº¡ng thÃ¡i lÃ  báº¯t buá»™c
          </div>
        </div>
      </div>

      <div class="form-section project-preview" *ngIf="selectedProject">
        <h4 class="section-title">ğŸ‘ï¸ Xem trÆ°á»›c thay Ä‘á»•i</h4>
        <div class="preview-card">
          <div class="preview-header">
            <div class="preview-icon">ğŸ“</div>
            <div class="preview-info">
              <h5>{{ editProjectForm.get('name')?.value || selectedProject.name }}</h5>
              <p>{{ editProjectForm.get('description')?.value || selectedProject.description }}</p>
            </div>
            <div class="preview-status">
              <span class="status-badge" [class]="editProjectForm.get('status')?.value || selectedProject.status">
                {{ editProjectForm.get('status')?.value === 'planning' ? 'ğŸ“‹ Láº­p káº¿ hoáº¡ch' : 
                   editProjectForm.get('status')?.value === 'active' ? 'ğŸš€ Äang thá»±c hiá»‡n' : 
                   editProjectForm.get('status')?.value === 'on-hold' ? 'â¸ï¸ Táº¡m dá»«ng' : 
                   editProjectForm.get('status')?.value === 'completed' ? 'âœ… HoÃ n thÃ nh' : 
                   getProjectStatusText(selectedProject.status) }}
              </span>
            </div>
          </div>
          <div class="preview-meta">
            <div class="meta-item">
              <span class="meta-icon">ğŸ“…</span>
              <span class="meta-text">
                {{ editProjectForm.get('startDate')?.value || selectedProject.startDate | date:'dd/MM/yyyy' }} - 
                {{ editProjectForm.get('endDate')?.value || selectedProject.endDate | date:'dd/MM/yyyy' }}
              </span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeEditProject()">
          <span class="btn-icon">âŒ</span>
          Há»§y bá»
        </button>
        <button type="submit" 
                class="btn btn-primary" 
                [disabled]="!editProjectForm.valid || editProjectForm.pristine">
          <span class="btn-icon">ğŸ’¾</span>
          Cáº­p nháº­t dá»± Ã¡n
        </button>
      </div>
    </form>
  </div>
</div>
