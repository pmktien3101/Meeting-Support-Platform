<div class="pm-projects">
  <div class="page-header">
    <div class="header-content">
      <h2>📁 Quản Lý Dự Án</h2>
      <p>Theo dõi và quản lý các dự án của bạn</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateProject()">
        ➕ Tạo Dự Án Mới
      </button>
      <button class="btn btn-secondary">
        📊 Xem Báo Cáo
      </button>
    </div>
  </div>

  <div class="projects-filters">
    <div class="filter-group">
      <label>Trạng thái:</label>
      <select class="filter-select" aria-label="Lọc theo trạng thái">
        <option value="">Tất cả</option>
        <option value="planning">Lập kế hoạch</option>
        <option value="active">Đang thực hiện</option>
        <option value="on-hold">Tạm dừng</option>
        <option value="completed">Hoàn thành</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Quản lý:</label>
      <select class="filter-select" aria-label="Lọc theo quản lý">
        <option value="">Tất cả</option>
        <option value="me">Của tôi</option>
        <option value="team">Của nhóm</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Tìm kiếm:</label>
      <input type="text" class="filter-input" placeholder="Tìm kiếm dự án...">
    </div>
  </div>

  <div class="projects-grid">
    <div class="project-card" *ngFor="let project of projects">
      <div class="project-header">
        <div class="project-icon">📁</div>
        <div class="project-status">
          <span class="status-badge" [class]="project.status">
            {{ getProjectStatusText(project.status) }}
          </span>
        </div>
      </div>
      
      <div class="project-content">
        <h3 class="project-title">{{ project.name }}</h3>
        <p class="project-description">{{ project.description }}</p>
        
        <div class="project-meta">
          <div class="meta-item">
            <span class="meta-icon">📅</span>
            <span class="meta-text">
              {{ project.startDate | date:'dd/MM/yyyy' }} - {{ project.endDate | date:'dd/MM/yyyy' }}
            </span>
          </div>
          <div class="meta-item">
            <span class="meta-icon">👤</span>
            <span class="meta-text">{{ project.manager }}</span>
          </div>
          <div class="meta-item">
            <span class="meta-icon">👥</span>
            <span class="meta-text">{{ project.members.length }} thành viên</span>
          </div>
        </div>
        
        <div class="project-progress">
          <div class="progress-header">
            <span class="progress-label">Tiến độ</span>
            <span class="progress-percentage">{{ project.progress }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="project.progress"></div>
          </div>
        </div>
      </div>
      
      <div class="project-actions">
        <button class="btn btn-primary btn-sm" (click)="viewProjectMilestones(project.id)">Xem Chi Tiết</button>
        <button class="btn btn-secondary btn-sm" (click)="openEditProject(project)">Chỉnh Sửa</button>
        <button class="btn btn-outline btn-sm">📊 Báo Cáo</button>
      </div>
    </div>
  </div>

  <div class="projects-summary">
    <div class="summary-card">
      <div class="summary-icon">📊</div>
      <div class="summary-content">
        <h4>Tổng số dự án</h4>
        <p class="summary-number">{{ projects.length }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">🚀</div>
      <div class="summary-content">
        <h4>Đang thực hiện</h4>
        <p class="summary-number">{{ getActiveProjectsCount() }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">✅</div>
      <div class="summary-content">
        <h4>Hoàn thành</h4>
        <p class="summary-number">{{ getCompletedProjectsCount() }}</p>
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-icon">⏰</div>
      <div class="summary-content">
        <h4>Trung bình hoàn thành</h4>
        <p class="summary-number">{{ getAverageProgress() }}%</p>
      </div>
    </div>
  </div>
</div>

<!-- Edit Project Modal -->
<div class="modal-overlay" *ngIf="showEditProjectModal" (click)="closeEditProject()">
  <div class="modal edit-project-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">✏️</div>
        <div class="header-text">
          <h3>Chỉnh Sửa Dự Án</h3>
          <p>Cập nhật thông tin dự án {{ selectedProject?.name }}</p>
        </div>
      </div>
      <button class="modal-close" (click)="closeEditProject()" title="Đóng">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <form [formGroup]="editProjectForm" (ngSubmit)="submitEditProject()" class="modal-form">
      <div class="form-section">
        <h4 class="section-title">📋 Thông tin cơ bản</h4>
        
        <div class="form-group">
          <label for="editProjectName">
            <span class="label-icon">📝</span>
            Tên dự án <span class="required">*</span>
          </label>
          <input type="text" 
                 id="editProjectName" 
                 formControlName="name" 
                 placeholder="Nhập tên dự án"
                 class="form-input">
          <div class="error-message" *ngIf="editProjectForm.get('name')?.invalid && editProjectForm.get('name')?.touched">
            <span class="error-icon">⚠️</span>
            Tên dự án phải có ít nhất 3 ký tự
          </div>
        </div>
        
        <div class="form-group">
          <label for="editProjectDescription">
            <span class="label-icon">📄</span>
            Mô tả dự án <span class="required">*</span>
          </label>
          <textarea id="editProjectDescription" 
                    formControlName="description" 
                    rows="4" 
                    placeholder="Mô tả chi tiết về dự án..."
                    class="form-textarea"></textarea>
          <div class="error-message" *ngIf="editProjectForm.get('description')?.invalid && editProjectForm.get('description')?.touched">
            <span class="error-icon">⚠️</span>
            Mô tả dự án là bắt buộc
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">📅 Thời gian dự án</h4>
        
        <div class="form-row">
          <div class="form-group">
            <label for="editStartDate">
              <span class="label-icon">🚀</span>
              Ngày bắt đầu <span class="required">*</span>
            </label>
            <input type="date" 
                   id="editStartDate" 
                   formControlName="startDate"
                   class="form-input">
            <div class="error-message" *ngIf="editProjectForm.get('startDate')?.invalid && editProjectForm.get('startDate')?.touched">
              <span class="error-icon">⚠️</span>
              Ngày bắt đầu là bắt buộc
            </div>
          </div>
          <div class="form-group">
            <label for="editEndDate">
              <span class="label-icon">🏁</span>
              Ngày kết thúc <span class="required">*</span>
            </label>
            <input type="date" 
                   id="editEndDate" 
                   formControlName="endDate"
                   class="form-input">
            <div class="error-message" *ngIf="editProjectForm.get('endDate')?.invalid && editProjectForm.get('endDate')?.touched">
              <span class="error-icon">⚠️</span>
              Ngày kết thúc là bắt buộc
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h4 class="section-title">📊 Trạng thái dự án</h4>
        
        <div class="form-group">
          <label for="editProjectStatus">
            <span class="label-icon">🎯</span>
            Trạng thái <span class="required">*</span>
          </label>
          <div class="status-select-wrapper">
            <select id="editProjectStatus" formControlName="status" class="form-select">
              <option value="planning">📋 Lập kế hoạch</option>
              <option value="active">🚀 Đang thực hiện</option>
              <option value="on-hold">⏸️ Tạm dừng</option>
              <option value="completed">✅ Hoàn thành</option>
            </select>
            <div class="select-arrow">▼</div>
          </div>
          <div class="error-message" *ngIf="editProjectForm.get('status')?.invalid && editProjectForm.get('status')?.touched">
            <span class="error-icon">⚠️</span>
            Trạng thái là bắt buộc
          </div>
        </div>
      </div>

      <div class="form-section project-preview" *ngIf="selectedProject">
        <h4 class="section-title">👁️ Xem trước thay đổi</h4>
        <div class="preview-card">
          <div class="preview-header">
            <div class="preview-icon">📁</div>
            <div class="preview-info">
              <h5>{{ editProjectForm.get('name')?.value || selectedProject.name }}</h5>
              <p>{{ editProjectForm.get('description')?.value || selectedProject.description }}</p>
            </div>
            <div class="preview-status">
              <span class="status-badge" [class]="editProjectForm.get('status')?.value || selectedProject.status">
                {{ editProjectForm.get('status')?.value === 'planning' ? '📋 Lập kế hoạch' : 
                   editProjectForm.get('status')?.value === 'active' ? '🚀 Đang thực hiện' : 
                   editProjectForm.get('status')?.value === 'on-hold' ? '⏸️ Tạm dừng' : 
                   editProjectForm.get('status')?.value === 'completed' ? '✅ Hoàn thành' : 
                   getProjectStatusText(selectedProject.status) }}
              </span>
            </div>
          </div>
          <div class="preview-meta">
            <div class="meta-item">
              <span class="meta-icon">📅</span>
              <span class="meta-text">
                {{ editProjectForm.get('startDate')?.value || selectedProject.startDate | date:'dd/MM/yyyy' }} - 
                {{ editProjectForm.get('endDate')?.value || selectedProject.endDate | date:'dd/MM/yyyy' }}
              </span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeEditProject()">
          <span class="btn-icon">❌</span>
          Hủy bỏ
        </button>
        <button type="submit" 
                class="btn btn-primary" 
                [disabled]="!editProjectForm.valid || editProjectForm.pristine">
          <span class="btn-icon">💾</span>
          Cập nhật dự án
        </button>
      </div>
    </form>
  </div>
</div>
