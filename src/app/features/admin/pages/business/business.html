<div class="business-management">
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Quáº£n LÃ½ ÄÄƒng KÃ½ Doanh Nghiá»‡p</h1>
      <p class="page-description">PhÃª duyá»‡t hoáº·c tá»« chá»‘i cÃ¡c yÃªu cáº§u Ä‘Äƒng kÃ½ doanh nghiá»‡p má»›i</p>
    </div>
  </div>


  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="TÃ¬m kiáº¿m doanh nghiá»‡p, email..." 
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        class="search-input"
      >
      <span class="search-icon">ğŸ”</span>
    </div>
    
    <div class="filter-controls">
      <select [(ngModel)]="statusFilter" (change)="onFilterChange()" class="filter-select" aria-label="Lá»c theo tráº¡ng thÃ¡i">
        <option value="">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
        <option value="pending">Chá» phÃª duyá»‡t</option>
        <option value="active">Hoáº¡t Ä‘á»™ng</option>
        <option value="inactive">ÄÃ£ khÃ³a</option>
        <option value="rejected">ÄÃ£ tá»« chá»‘i</option>
      </select>
      
      <select [(ngModel)]="sortBy" (change)="onSortChange()" class="filter-select" aria-label="Sáº¯p xáº¿p">
        <option value="registrationDate">Sáº¯p xáº¿p theo ngÃ y Ä‘Äƒng kÃ½</option>
        <option value="name">Sáº¯p xáº¿p theo tÃªn</option>
        <option value="userCount">Sáº¯p xáº¿p theo sá»‘ ngÆ°á»i dÃ¹ng</option>
      </select>
    </div>
  </div>

  <!-- Business List -->
  <div class="business-list">
    <div class="table-container">
      <table class="business-table">
        <thead>
          <tr>
            <th>Logo</th>
            <th>TÃªn Doanh Nghiá»‡p</th>
            <th>Chá»§ Sá»Ÿ Há»¯u</th>
            <th>Email</th>
            <th>Tráº¡ng ThÃ¡i</th>
            <th>Sá»‘ NgÆ°á»i DÃ¹ng</th>
            <th>NgÃ y ÄÄƒng KÃ½</th>
            <th>Thao TÃ¡c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let business of filteredBusinesses()" class="business-row">
            <td class="business-logo">
              <div class="logo-placeholder">{{ business.name.charAt(0) }}</div>
            </td>
            <td class="business-name">
              <div class="name-info">
                <div class="primary-name">{{ business.name }}</div>
                <div class="secondary-info">{{ business.industry }}</div>
              </div>
            </td>
            <td class="owner-info">
              <div class="owner-name">{{ business.ownerName }}</div>
              <div class="owner-email">{{ business.ownerEmail }}</div>
            </td>
            <td class="business-email">{{ business.email }}</td>
            <td class="business-status">
              <span class="status-badge" [class]="getStatusClass(business.status)">
                {{ getStatusText(business.status) }}
              </span>
              <div *ngIf="business.rejectionReason" class="rejection-reason">
                {{ business.rejectionReason }}
              </div>
            </td>
            <td class="user-count">
              <div class="user-count-info">
                <div class="user-count-number">{{ business.userCount }}</div>
                <div class="user-count-max">/ {{ business.maxUsers }}</div>
              </div>
            </td>
            <td class="registration-date">{{ business.registrationDate | date:'dd/MM/yyyy' }}</td>
            <td class="actions">
              <div class="action-buttons">
                <button 
                  class="btn-icon" 
                  (click)="viewBusiness(business)"
                  title="Xem chi tiáº¿t"
                >
                  ğŸ‘ï¸
                </button>
                
                <!-- Approval buttons for pending businesses -->
                <ng-container *ngIf="business.status === 'pending'">
                  <button 
                    class="btn-icon approve" 
                    (click)="openApprovalModal(business, 'approve')"
                    title="PhÃª duyá»‡t"
                  >
                    âœ…
                  </button>
                  <button 
                    class="btn-icon reject" 
                    (click)="openApprovalModal(business, 'reject')"
                    title="Tá»« chá»‘i"
                  >
                    âŒ
                  </button>
                </ng-container>

                <!-- Management buttons for active businesses -->
                <ng-container *ngIf="business.status === 'active'">
                  <button 
                    class="btn-icon" 
                    (click)="editBusiness(business)"
                    title="Chá»‰nh sá»­a"
                  >
                    âœï¸
                  </button>
                  <button 
                    class="btn-icon" 
                    (click)="manageQuota(business)"
                    title="Quáº£n lÃ½ quota"
                  >
                    ğŸ“Š
                  </button>
                  <button 
                    class="btn-icon danger" 
                    (click)="toggleBusinessStatus(business)"
                    title="KhÃ³a doanh nghiá»‡p"
                  >
                    ğŸ”’
                  </button>
                </ng-container>

                <!-- Reactivate button for inactive businesses -->
                <ng-container *ngIf="business.status === 'inactive'">
                  <button 
                    class="btn-icon approve" 
                    (click)="toggleBusinessStatus(business)"
                    title="KÃ­ch hoáº¡t láº¡i"
                  >
                    ğŸ”“
                  </button>
                </ng-container>

                <!-- View rejection reason for rejected businesses -->
                <ng-container *ngIf="business.status === 'rejected'">
                  <button 
                    class="btn-icon" 
                    (click)="viewBusiness(business)"
                    title="Xem lÃ½ do tá»« chá»‘i"
                  >
                    ğŸ“‹
                  </button>
                </ng-container>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages() > 1">
    <button 
      class="pagination-btn" 
      [disabled]="currentPage() === 1"
      (click)="goToPage(currentPage() - 1)"
    >
      â†
    </button>
    
    <div class="page-numbers">
      <button 
        *ngFor="let page of getPageNumbers()" 
        class="page-number"
        [class.active]="page === currentPage()"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>
    </div>
    
    <button 
      class="pagination-btn" 
      [disabled]="currentPage() === totalPages()"
      (click)="goToPage(currentPage() + 1)"
    >
      â†’
    </button>
  </div>
</div>

<!-- Approval Modal -->
<div class="modal-overlay" *ngIf="showApprovalModal()" (click)="closeApprovalModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ approvalAction() === 'approve' ? 'PhÃª Duyá»‡t Doanh Nghiá»‡p' : 'Tá»« Chá»‘i Doanh Nghiá»‡p' }}</h3>
      <button class="modal-close" (click)="closeApprovalModal()">Ã—</button>
    </div>
    
    <div class="modal-body">
      <div class="business-info" *ngIf="selectedBusiness()">
        <h4>{{ selectedBusiness()?.name }}</h4>
        <p><strong>Chá»§ sá»Ÿ há»¯u:</strong> {{ selectedBusiness()?.ownerName }}</p>
        <p><strong>Email:</strong> {{ selectedBusiness()?.ownerEmail }}</p>
        <p><strong>NgÃ nh nghá»:</strong> {{ selectedBusiness()?.industry }}</p>
        <p><strong>NgÃ y Ä‘Äƒng kÃ½:</strong> {{ selectedBusiness()?.registrationDate | date:'dd/MM/yyyy' }}</p>
      </div>

      <div *ngIf="approvalAction() === 'reject'" class="form-group">
        <label for="rejectionReason">LÃ½ do tá»« chá»‘i *</label>
        <textarea 
          id="rejectionReason"
          [(ngModel)]="rejectionReason"
          placeholder="Nháº­p lÃ½ do tá»« chá»‘i Ä‘Äƒng kÃ½..."
          class="form-textarea"
          rows="3"
          required
        ></textarea>
      </div>

      <div *ngIf="approvalAction() === 'approve'" class="approval-message">
        <p>Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n phÃª duyá»‡t doanh nghiá»‡p nÃ y?</p>
        <p>Doanh nghiá»‡p sáº½ Ä‘Æ°á»£c kÃ­ch hoáº¡t vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng há»‡ thá»‘ng.</p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeApprovalModal()">Há»§y</button>
      <button 
        *ngIf="approvalAction() === 'approve'"
        class="btn btn-success" 
        (click)="approveBusiness()"
      >
        PhÃª Duyá»‡t
      </button>
      <button 
        *ngIf="approvalAction() === 'reject'"
        class="btn btn-danger" 
        (click)="rejectBusiness()"
        [disabled]="!rejectionReason().trim()"
      >
        Tá»« Chá»‘i
      </button>
    </div>
  </div>
</div>
