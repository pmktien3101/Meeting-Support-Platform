<div class="business-owner-dashboard">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading()">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!isLoading()">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <h1>T·ªïng Quan D·ª± √Ån</h1>
        <p>Qu·∫£n l√Ω d·ª± √°n, milestone v√† cu·ªôc h·ªçp c·ªßa t·ªï ch·ª©c</p>
      </div>
                   <div class="header-actions">
               <button class="btn-primary" (click)="openCreatePMModal()" [disabled]="showCreatePMModal() || isSubmitting()">
                 <span class="icon">üë§</span>
                 T·∫°o PM M·ªõi
               </button>
               <button class="btn-secondary" (click)="onViewAllMilestones()">
                 <span class="icon">üéØ</span>
                 Xem T·∫•t C·∫£ Milestone
               </button>
             </div>
    </div>

    <!-- Quick Actions -->
                 <div class="quick-actions">
               <div class="action-card" (click)="openCreatePMModal()" [class.disabled]="showCreatePMModal() || isSubmitting()">
                 <div class="action-icon">üë§</div>
                 <h3>T·∫°o PM M·ªõi</h3>
                 <p>Th√™m Project Manager</p>
               </div>
               <div class="action-card" (click)="onViewAllMilestones()">
                 <div class="action-icon">üéØ</div>
                 <h3>Xem Milestone</h3>
                 <p>Theo d√µi ti·∫øn ƒë·ªô</p>
               </div>
               <div class="action-card" (click)="onViewAllMeetings()">
                 <div class="action-icon">üìÖ</div>
                 <h3>L·ªãch H·ªçp</h3>
                 <p>Xem cu·ªôc h·ªçp</p>
               </div>
               <div class="action-card" (click)="onViewAllMeetings()">
                 <div class="action-icon">üë•</div>
                 <h3>Qu·∫£n L√Ω PM</h3>
                 <p>G√°n PM cho d·ª± √°n</p>
               </div>
             </div>

    <!-- Summary Stats -->
    <div class="summary-stats">
      <div class="stat-card">
        <div class="stat-icon">üìÅ</div>
        <div class="stat-content">
          <div class="stat-value">{{ summaryStats().totalProjects }}</div>
          <div class="stat-label">T·ªïng D·ª± √Ån</div>
          <div class="stat-detail">{{ summaryStats().activeProjects }} ƒëang ho·∫°t ƒë·ªông</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üéØ</div>
        <div class="stat-content">
          <div class="stat-value">{{ summaryStats().totalMilestones }}</div>
          <div class="stat-label">T·ªïng Milestone</div>
          <div class="stat-detail">{{ summaryStats().completedMilestones }} ho√†n th√†nh</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üë®‚Äçüíº</div>
        <div class="stat-content">
          <div class="stat-value">{{ summaryStats().totalPMs }}</div>
          <div class="stat-label">Project Manager</div>
          <div class="stat-detail">{{ summaryStats().availablePMs }} c√≥ s·∫µn</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-content">
          <div class="stat-value">{{ summaryStats().upcomingMeetings }}</div>
          <div class="stat-label">Cu·ªôc H·ªçp S·∫Øp T·ªõi</div>
          <div class="stat-detail">Trong tu·∫ßn n√†y</div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
      <!-- Project Management -->
      <div class="dashboard-card project-management">
                         <div class="card-header">
                   <h2>Qu·∫£n L√Ω D·ª± √Ån</h2>
                   <div class="header-actions">
                     <button class="btn-small" (click)="openCreatePMModal()" [disabled]="showCreatePMModal() || isSubmitting()">
                       + T·∫°o PM
                     </button>
                     <button class="btn-small" (click)="onViewAllMilestones()">Xem T·∫•t C·∫£</button>
                   </div>
                 </div>
        <div class="card-content">
          <div class="projects-list">
            <div class="project-item" *ngFor="let project of projects()">
              <div class="project-header">
                <div class="project-info">
                  <div class="project-name">{{ project.name }}</div>
                  <div class="project-meta">
                    <span class="project-status" [style.background]="getStatusColor(project.status)">
                      {{ getStatusText(project.status) }}
                    </span>
                    <span class="project-priority" [style.background]="getPriorityColor(project.priority)">
                      {{ getPriorityText(project.priority) }}
                    </span>
                    <span class="project-budget">Ng√¢n s√°ch: {{ project.budget | number }}‚Ç´</span>
                  </div>
                </div>
                <div class="project-actions">
                  <button class="btn-small" (click)="onViewProjectDetails(project.id)">Chi ti·∫øt</button>
                  <button class="btn-small" (click)="onAssignPM(project.id)">G√°n PM</button>
                </div>
              </div>
              <div class="project-details">
                <div class="project-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="project.progress"></div>
                  </div>
                  <div class="progress-text">{{ project.progress }}%</div>
                </div>
                <div class="project-stats">
                  <div class="stat">
                    <span class="stat-label">PM:</span>
                    <span class="stat-value" [class.pm-unassigned]="!project.manager" [class.pm-assigned]="project.manager">
                      {{ project.manager || 'Ch∆∞a g√°n' }}
                    </span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Nh√≥m:</span>
                    <span class="stat-value">{{ project.teamSize }}</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Milestone:</span>
                    <span class="stat-value">{{ project.completedMilestones }}/{{ project.totalMilestones }}</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Task:</span>
                    <span class="stat-value">{{ project.completedTasks }}/{{ project.totalTasks }}</span>
                  </div>
                </div>
                <div class="project-timeline">
                  <div class="timeline-item">
                    <span class="timeline-label">B·∫Øt ƒë·∫ßu:</span>
                    <span class="timeline-value">{{ formatDate(project.startDate) }}</span>
                  </div>
                  <div class="timeline-item">
                    <span class="timeline-label">K·∫øt th√∫c:</span>
                    <span class="timeline-value">{{ formatDate(project.endDate) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Milestones Overview -->
      <div class="dashboard-card milestones-overview">
        <div class="card-header">
          <h2>T·ªïng Quan Milestone</h2>
          <div class="header-actions">
            <button class="btn-small" (click)="onViewAllMilestones()">Xem T·∫•t C·∫£</button>
          </div>
        </div>
        <div class="card-content">
          <div class="milestones-list">
            <div class="milestone-item" *ngFor="let milestone of milestones()">
              <div class="milestone-header">
                <span class="milestone-name">{{ milestone.name }}</span>
                <span class="milestone-status" [style.background]="getMilestoneStatusColor(milestone.status)">
                  {{ getMilestoneStatusText(milestone.status) }}
                </span>
              </div>
              <div class="milestone-description">{{ milestone.description }}</div>
              <div class="milestone-meta">
                <div class="meta-item">
                  <span class="meta-label">D·ª± √°n:</span>
                  <span class="meta-value">{{ getProjectName(milestone.projectId) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Deadline:</span>
                  <span class="meta-value">{{ formatDate(milestone.dueDate) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Ng∆∞·ªùi ph·ª• tr√°ch:</span>
                  <span class="meta-value">{{ milestone.assignedTo }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Ti·∫øn ƒë·ªô:</span>
                  <span class="meta-value">{{ milestone.progress }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Upcoming Meetings -->
      <div class="dashboard-card upcoming-meetings">
        <div class="card-header">
          <h2>Cu·ªôc H·ªçp S·∫Øp T·ªõi</h2>
          <div class="header-actions">
            <button class="btn-small" (click)="onViewAllMeetings()">Xem T·∫•t C·∫£</button>
          </div>
        </div>
        <div class="card-content">
          <div class="meetings-list">
            <div class="meeting-item" *ngFor="let meeting of meetings()">
              <div class="meeting-header">
                <h4 class="meeting-title">{{ meeting.title }}</h4>
                <span class="meeting-type">{{ getMeetingTypeText(meeting.type) }}</span>
              </div>
              <div class="meeting-meta">
                <div class="meta-item">
                  <span class="meta-label">D·ª± √°n:</span>
                  <span class="meta-value">{{ getProjectName(meeting.projectId) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Th·ªùi gian:</span>
                  <span class="meta-value">{{ formatDateTime(meeting.date) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Th·ªùi l∆∞·ª£ng:</span>
                  <span class="meta-value">{{ meeting.duration }} ph√∫t</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Tham gia:</span>
                  <span class="meta-value">{{ meeting.participants.length }} ng∆∞·ªùi</span>
                </div>
              </div>
              <p class="meeting-agenda">{{ meeting.agenda }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Available Project Managers -->
      <div class="dashboard-card available-pms">
        <div class="card-header">
          <h2>Project Manager C√≥ S·∫µn</h2>
        </div>
        <div class="card-content">
          <div class="pms-list">
            <div class="pm-item" *ngFor="let pm of getAvailablePMs()">
              <div class="pm-header">
                <div class="pm-avatar">{{ pm.avatar }}</div>
                <div class="pm-info">
                  <h4 class="pm-name">{{ pm.name }}</h4>
                  <p class="pm-role">{{ pm.role }}</p>
                </div>
                <div class="pm-rating">
                  <span class="rating-value">{{ pm.rating }}</span>
                  <span class="rating-star">‚≠ê</span>
                </div>
              </div>
              <div class="pm-details">
                <div class="pm-expertise">
                  <span class="expertise-label">Chuy√™n m√¥n:</span>
                  <div class="expertise-tags">
                    <span class="expertise-tag" *ngFor="let skill of pm.expertise">{{ skill }}</span>
                  </div>
                </div>
                <div class="pm-capacity">
                  <span class="capacity-label">D·ª± √°n:</span>
                  <span class="capacity-value">{{ pm.managedProjects }}/{{ pm.maxProjects }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Assign PM Modal -->
  <div class="modal-overlay" *ngIf="showAssignPMModal()" (click)="onCloseModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>G√°n Project Manager</h3>
        <button class="modal-close" (click)="onCloseModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="project-info" *ngIf="selectedProject()">
          <h4>D·ª± √°n: {{ selectedProject()?.name }}</h4>
          <p>Ch·ªçn PM ƒë·ªÉ g√°n cho d·ª± √°n n√†y:</p>
        </div>
        <div class="pm-selection">
          <div class="pm-option" *ngFor="let pm of getAvailablePMs()" (click)="onAssignProjectToPM(selectedProject()?.id || 0, pm.id)">
            <div class="pm-avatar">{{ pm.avatar }}</div>
            <div class="pm-details">
              <h5>{{ pm.name }}</h5>
              <p>{{ pm.role }}</p>
              <span class="pm-rating">‚≠ê {{ pm.rating }}</span>
            </div>
            <div class="pm-status">
              <span class="status-available">C√≥ s·∫µn</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Project Details Modal -->
  <div class="modal-overlay" *ngIf="showProjectDetailsModal()" (click)="onCloseModal()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Chi Ti·∫øt D·ª± √Ån</h3>
        <button class="modal-close" (click)="onCloseModal()">√ó</button>
      </div>
      <div class="modal-body" *ngIf="selectedProject()">
        <div class="project-overview">
          <h4>{{ selectedProject()?.name }}</h4>
          <div class="project-stats-grid">
            <div class="stat-item">
              <span class="stat-label">Tr·∫°ng th√°i:</span>
              <span class="stat-value" [style.color]="getStatusColor(selectedProject()?.status || '')">
                {{ getStatusText(selectedProject()?.status || '') }}
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Ti·∫øn ƒë·ªô:</span>
              <span class="stat-value">{{ selectedProject()?.progress }}%</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">PM:</span>
              <span class="stat-value">{{ selectedProject()?.manager || 'Ch∆∞a g√°n' }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Team size:</span>
              <span class="stat-value">{{ selectedProject()?.teamSize }} ng∆∞·ªùi</span>
            </div>
          </div>
        </div>

        <div class="project-milestones">
          <h5>Milestones</h5>
          <div class="milestones-grid">
            <div class="milestone-card" *ngFor="let milestone of getProjectMilestones(selectedProject()?.id || 0)">
              <div class="milestone-header">
                <h6>{{ milestone.name }}</h6>
                <span class="milestone-status" [style.background-color]="getMilestoneStatusColor(milestone.status)">
                  {{ getMilestoneStatusText(milestone.status) }}
                </span>
              </div>
              <p>{{ milestone.description }}</p>
              <div class="milestone-meta">
                <span>H·∫°n: {{ formatDate(milestone.dueDate) }}</span>
                <span>Ti·∫øn ƒë·ªô: {{ milestone.progress }}%</span>
              </div>
            </div>
          </div>
        </div>

        <div class="project-meetings">
          <h5>Cu·ªôc H·ªçp</h5>
          <div class="meetings-grid">
            <div class="meeting-card" *ngFor="let meeting of getProjectMeetings(selectedProject()?.id || 0)">
              <div class="meeting-header">
                <h6>{{ meeting.title }}</h6>
                <span class="meeting-type">{{ getMeetingTypeText(meeting.type) }}</span>
              </div>
              <div class="meeting-meta">
                <span>Th·ªùi gian: {{ formatDateTime(meeting.date) }}</span>
                <span>Th·ªùi l∆∞·ª£ng: {{ meeting.duration }} ph√∫t</span>
              </div>
              <p class="meeting-agenda">{{ meeting.agenda }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create New PM Modal -->
<div *ngIf="showCreatePMModal()" class="modal-overlay" (click)="closeCreatePMModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>T·∫°o Project Manager M·ªõi</h2>
      <button class="modal-close" (click)="closeCreatePMModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <form (ngSubmit)="createNewPM()" #pmForm="ngForm">
        <div class="form-row">
          <label>H·ªç t√™n</label>
          <input type="text" [(ngModel)]="newPMForm().name" name="name" required />
          <div class="error" *ngIf="formErrors().name">{{ formErrors().name }}</div>
        </div>
        <div class="form-row">
          <label>Email</label>
          <input type="email" [(ngModel)]="newPMForm().email" name="email" required />
          <div class="error" *ngIf="formErrors().email">{{ formErrors().email }}</div>
        </div>
        <div class="form-row">
          <label>S·ªë ƒëi·ªán tho·∫°i</label>
          <input type="text" [(ngModel)]="newPMForm().phone" name="phone" required />
          <div class="error" *ngIf="formErrors().phone">{{ formErrors().phone }}</div>
        </div>
        <div class="form-row">
          <label>Ch·ª©c v·ª•</label>
          <input type="text" [(ngModel)]="newPMForm().position" name="position" required />
          <div class="error" *ngIf="formErrors().position">{{ formErrors().position }}</div>
        </div>
        <div class="form-row">
          <label>Ph√≤ng ban</label>
          <input type="text" [(ngModel)]="newPMForm().department" name="department" required />
          <div class="error" *ngIf="formErrors().department">{{ formErrors().department }}</div>
        </div>
        <div class="form-row">
          <label>Ng√†y b·∫Øt ƒë·∫ßu</label>
          <input type="date" [(ngModel)]="newPMForm().startDate" name="startDate" required />
          <div class="error" *ngIf="formErrors().startDate">{{ formErrors().startDate }}</div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeCreatePMModal()">H·ªßy</button>
      <button 
        class="btn btn-primary" 
        (click)="createNewPM()"
        [disabled]="isSubmitting()"
      >
        <span *ngIf="isSubmitting()" class="spinner-small"></span>
        {{ isSubmitting() ? 'ƒêang t·∫°o...' : 'T·∫°o Project Manager' }}
      </button>
    </div>
  </div>
</div>
