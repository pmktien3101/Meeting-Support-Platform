<div class="business-owner-dashboard">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading()">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu dashboard...</p>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!isLoading()">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <h1>T·ªïng Quan D·ª± √Ån</h1>
        <p>Qu·∫£n l√Ω d·ª± √°n, milestone v√† cu·ªôc h·ªçp c·ªßa t·ªï ch·ª©c</p>
      </div>
                   <div class="header-actions">
               <button class="btn-primary" (click)="openCreatePMModal()">
                 <span class="icon">üë§</span>
                 T·∫°o PM M·ªõi
               </button>
               <button class="btn-secondary" (click)="onViewAllMilestones()">
                 <span class="icon">üéØ</span>
                 Xem T·∫•t C·∫£ Milestone
               </button>
             </div>
    </div>

    <!-- Quick Actions -->
                 <div class="quick-actions">
               <div class="action-card" (click)="openCreatePMModal()">
                 <div class="action-icon">üë§</div>
                 <h3>T·∫°o PM M·ªõi</h3>
                 <p>Th√™m Project Manager</p>
               </div>
               <div class="action-card" (click)="onViewAllMilestones()">
                 <div class="action-icon">üéØ</div>
                 <h3>Xem Milestone</h3>
                 <p>Theo d√µi ti·∫øn ƒë·ªô</p>
               </div>
               <div class="action-card" (click)="onViewAllMeetings()">
                 <div class="action-icon">üìÖ</div>
                 <h3>L·ªãch H·ªçp</h3>
                 <p>Xem cu·ªôc h·ªçp</p>
               </div>
               <div class="action-card" (click)="onViewAllMeetings()">
                 <div class="action-icon">üë•</div>
                 <h3>Qu·∫£n L√Ω PM</h3>
                 <p>G√°n PM cho d·ª± √°n</p>
               </div>
             </div>

    <!-- Summary Stats -->
    <div class="summary-stats">
      <div class="stat-card">
        <div class="stat-icon">üìÅ</div>
        <div class="stat-content">
          <div class="stat-value">{{ summaryStats().totalProjects }}</div>
          <div class="stat-label">T·ªïng D·ª± √Ån</div>
          <div class="stat-detail">{{ summaryStats().activeProjects }} ƒëang ho·∫°t ƒë·ªông</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üéØ</div>
        <div class="stat-content">
          <div class="stat-value">{{ summaryStats().totalMilestones }}</div>
          <div class="stat-label">T·ªïng Milestone</div>
          <div class="stat-detail">{{ summaryStats().completedMilestones }} ho√†n th√†nh</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üë®‚Äçüíº</div>
        <div class="stat-content">
          <div class="stat-value">{{ summaryStats().totalPMs }}</div>
          <div class="stat-label">Project Manager</div>
          <div class="stat-detail">{{ summaryStats().availablePMs }} c√≥ s·∫µn</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-content">
          <div class="stat-value">{{ summaryStats().upcomingMeetings }}</div>
          <div class="stat-label">Cu·ªôc H·ªçp S·∫Øp T·ªõi</div>
          <div class="stat-detail">Trong tu·∫ßn n√†y</div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
      <!-- Project Management -->
      <div class="dashboard-card project-management">
                         <div class="card-header">
                   <h2>Qu·∫£n L√Ω D·ª± √Ån</h2>
                   <div class="header-actions">
                     <button class="btn-small" (click)="openCreatePMModal()">+ T·∫°o PM</button>
                     <button class="btn-small" (click)="onViewAllMilestones()">Xem T·∫•t C·∫£</button>
                   </div>
                 </div>
        <div class="card-content">
          <div class="projects-list">
            <div class="project-item" *ngFor="let project of projects()">
              <div class="project-header">
                <div class="project-info">
                  <h3 class="project-name">{{ project.name }}</h3>
                  <div class="project-meta">
                    <span class="project-status" [style.background-color]="getStatusColor(project.status)">
                      {{ getStatusText(project.status) }}
                    </span>
                    <span class="project-priority" [style.background-color]="getPriorityColor(project.priority)">
                      {{ getPriorityText(project.priority) }}
                    </span>
                    <span class="project-budget">${{ project.budget.toLocaleString() }}</span>
                  </div>
                </div>
                <div class="project-actions">
                  <button class="btn-small" (click)="onViewProjectDetails(project.id)">
                    <span class="icon">üëÅÔ∏è</span>
                    Chi Ti·∫øt
                  </button>
                  <button class="btn-small" (click)="onEditProject(project.id)">
                    <span class="icon">‚úèÔ∏è</span>
                    S·ª≠a
                  </button>
                  <button 
                    class="btn-small" 
                    *ngIf="!project.manager"
                    (click)="onAssignPM(project.id)"
                  >
                    <span class="icon">üë§</span>
                    G√°n PM
                  </button>
                </div>
              </div>
              
              <div class="project-details">
                <div class="project-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="project.progress"></div>
                  </div>
                  <span class="progress-text">{{ project.progress }}%</span>
                </div>
                
                <div class="project-stats">
                  <div class="stat">
                    <span class="stat-label">PM:</span>
                    <span class="stat-value">{{ project.manager || 'Ch∆∞a g√°n' }}</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Team:</span>
                    <span class="stat-value">{{ project.teamSize }} ng∆∞·ªùi</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Milestone:</span>
                    <span class="stat-value">{{ project.completedMilestones }}/{{ project.totalMilestones }}</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">Tasks:</span>
                    <span class="stat-value">{{ project.completedTasks }}/{{ project.totalTasks }}</span>
                  </div>
                </div>

                <div class="project-timeline">
                  <div class="timeline-item">
                    <span class="timeline-label">B·∫Øt ƒë·∫ßu:</span>
                    <span class="timeline-value">{{ formatDate(project.startDate) }}</span>
                  </div>
                  <div class="timeline-item">
                    <span class="timeline-label">K·∫øt th√∫c:</span>
                    <span class="timeline-value">{{ formatDate(project.endDate) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Milestones Overview -->
      <div class="dashboard-card milestones-overview">
        <div class="card-header">
          <h2>T·ªïng Quan Milestone</h2>
          <div class="header-actions">
            <button class="btn-small" (click)="onViewAllMilestones()">Xem T·∫•t C·∫£</button>
          </div>
        </div>
        <div class="card-content">
          <div class="milestones-list">
            <div class="milestone-item" *ngFor="let milestone of milestones()">
              <div class="milestone-header">
                <h4 class="milestone-name">{{ milestone.name }}</h4>
                <span class="milestone-status" [style.background-color]="getMilestoneStatusColor(milestone.status)">
                  {{ getMilestoneStatusText(milestone.status) }}
                </span>
              </div>
              <p class="milestone-description">{{ milestone.description }}</p>
              <div class="milestone-meta">
                <div class="meta-item">
                  <span class="meta-label">D·ª± √°n:</span>
                  <span class="meta-value">{{ getProjectName(milestone.projectId) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Ng∆∞·ªùi th·ª±c hi·ªán:</span>
                  <span class="meta-value">{{ milestone.assignedTo }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">H·∫°n:</span>
                  <span class="meta-value">{{ formatDate(milestone.dueDate) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Ti·∫øn ƒë·ªô:</span>
                  <span class="meta-value">{{ milestone.progress }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Upcoming Meetings -->
      <div class="dashboard-card upcoming-meetings">
        <div class="card-header">
          <h2>Cu·ªôc H·ªçp S·∫Øp T·ªõi</h2>
          <div class="header-actions">
            <button class="btn-small" (click)="onViewAllMeetings()">Xem T·∫•t C·∫£</button>
          </div>
        </div>
        <div class="card-content">
          <div class="meetings-list">
            <div class="meeting-item" *ngFor="let meeting of meetings()">
              <div class="meeting-header">
                <h4 class="meeting-title">{{ meeting.title }}</h4>
                <span class="meeting-type">{{ getMeetingTypeText(meeting.type) }}</span>
              </div>
              <div class="meeting-meta">
                <div class="meta-item">
                  <span class="meta-label">D·ª± √°n:</span>
                  <span class="meta-value">{{ getProjectName(meeting.projectId) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Th·ªùi gian:</span>
                  <span class="meta-value">{{ formatDateTime(meeting.date) }}</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Th·ªùi l∆∞·ª£ng:</span>
                  <span class="meta-value">{{ meeting.duration }} ph√∫t</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Tham gia:</span>
                  <span class="meta-value">{{ meeting.participants.length }} ng∆∞·ªùi</span>
                </div>
              </div>
              <p class="meeting-agenda">{{ meeting.agenda }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Available Project Managers -->
      <div class="dashboard-card available-pms">
        <div class="card-header">
          <h2>Project Manager C√≥ S·∫µn</h2>
        </div>
        <div class="card-content">
          <div class="pms-list">
            <div class="pm-item" *ngFor="let pm of getAvailablePMs()">
              <div class="pm-header">
                <div class="pm-avatar">{{ pm.avatar }}</div>
                <div class="pm-info">
                  <h4 class="pm-name">{{ pm.name }}</h4>
                  <p class="pm-role">{{ pm.role }}</p>
                </div>
                <div class="pm-rating">
                  <span class="rating-value">{{ pm.rating }}</span>
                  <span class="rating-star">‚≠ê</span>
                </div>
              </div>
              <div class="pm-details">
                <div class="pm-expertise">
                  <span class="expertise-label">Chuy√™n m√¥n:</span>
                  <div class="expertise-tags">
                    <span class="expertise-tag" *ngFor="let skill of pm.expertise">{{ skill }}</span>
                  </div>
                </div>
                <div class="pm-capacity">
                  <span class="capacity-label">D·ª± √°n:</span>
                  <span class="capacity-value">{{ pm.managedProjects }}/{{ pm.maxProjects }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Assign PM Modal -->
  <div class="modal-overlay" *ngIf="showAssignPMModal()" (click)="onCloseModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>G√°n Project Manager</h3>
        <button class="modal-close" (click)="onCloseModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="project-info" *ngIf="selectedProject()">
          <h4>D·ª± √°n: {{ selectedProject()?.name }}</h4>
          <p>Ch·ªçn PM ƒë·ªÉ g√°n cho d·ª± √°n n√†y:</p>
        </div>
        <div class="pm-selection">
          <div class="pm-option" *ngFor="let pm of getAvailablePMs()" (click)="onAssignProjectToPM(selectedProject()?.id || 0, pm.id)">
            <div class="pm-avatar">{{ pm.avatar }}</div>
            <div class="pm-details">
              <h5>{{ pm.name }}</h5>
              <p>{{ pm.role }}</p>
              <span class="pm-rating">‚≠ê {{ pm.rating }}</span>
            </div>
            <div class="pm-status">
              <span class="status-available">C√≥ s·∫µn</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Project Details Modal -->
  <div class="modal-overlay" *ngIf="showProjectDetailsModal()" (click)="onCloseModal()">
    <div class="modal-content large" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Chi Ti·∫øt D·ª± √Ån</h3>
        <button class="modal-close" (click)="onCloseModal()">√ó</button>
      </div>
      <div class="modal-body" *ngIf="selectedProject()">
        <div class="project-overview">
          <h4>{{ selectedProject()?.name }}</h4>
          <div class="project-stats-grid">
            <div class="stat-item">
              <span class="stat-label">Tr·∫°ng th√°i:</span>
              <span class="stat-value" [style.color]="getStatusColor(selectedProject()?.status || '')">
                {{ getStatusText(selectedProject()?.status || '') }}
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Ti·∫øn ƒë·ªô:</span>
              <span class="stat-value">{{ selectedProject()?.progress }}%</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">PM:</span>
              <span class="stat-value">{{ selectedProject()?.manager || 'Ch∆∞a g√°n' }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Team size:</span>
              <span class="stat-value">{{ selectedProject()?.teamSize }} ng∆∞·ªùi</span>
            </div>
          </div>
        </div>

        <div class="project-milestones">
          <h5>Milestones</h5>
          <div class="milestones-grid">
            <div class="milestone-card" *ngFor="let milestone of getProjectMilestones(selectedProject()?.id || 0)">
              <div class="milestone-header">
                <h6>{{ milestone.name }}</h6>
                <span class="milestone-status" [style.background-color]="getMilestoneStatusColor(milestone.status)">
                  {{ getMilestoneStatusText(milestone.status) }}
                </span>
              </div>
              <p>{{ milestone.description }}</p>
              <div class="milestone-meta">
                <span>H·∫°n: {{ formatDate(milestone.dueDate) }}</span>
                <span>Ti·∫øn ƒë·ªô: {{ milestone.progress }}%</span>
              </div>
            </div>
          </div>
        </div>

        <div class="project-meetings">
          <h5>Cu·ªôc H·ªçp</h5>
          <div class="meetings-grid">
            <div class="meeting-card" *ngFor="let meeting of getProjectMeetings(selectedProject()?.id || 0)">
              <div class="meeting-header">
                <h6>{{ meeting.title }}</h6>
                <span class="meeting-type">{{ getMeetingTypeText(meeting.type) }}</span>
              </div>
              <div class="meeting-meta">
                <span>Th·ªùi gian: {{ formatDateTime(meeting.date) }}</span>
                <span>Th·ªùi l∆∞·ª£ng: {{ meeting.duration }} ph√∫t</span>
              </div>
              <p class="meeting-agenda">{{ meeting.agenda }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create New PM Modal -->
<div *ngIf="showCreatePMModal()" class="modal-overlay" (click)="closeCreatePMModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>T·∫°o Project Manager M·ªõi</h2>
      <button class="modal-close" (click)="closeCreatePMModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <form (ngSubmit)="createNewPM()" #pmForm="ngForm">
        <div class="form-row">
          <div class="form-group">
            <label for="name">H·ªç T√™n ƒê·∫ßy ƒê·ªß *</label>
            <input 
              type="text" 
              id="name"
              [(ngModel)]="newPMForm().name" 
              name="name"
              class="form-input"
              [class.error]="formErrors()['name']"
              placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß"
            >
            <span *ngIf="formErrors()['name']" class="error-message">{{ formErrors()['name'] }}</span>
          </div>
          
          <div class="form-group">
            <label for="email">ƒê·ªãa Ch·ªâ Email *</label>
            <input 
              type="email" 
              id="email"
              [(ngModel)]="newPMForm().email" 
              name="email"
              class="form-input"
              [class.error]="formErrors()['email']"
              placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email"
            >
            <span *ngIf="formErrors()['email']" class="error-message">{{ formErrors()['email'] }}</span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="phone">S·ªë ƒêi·ªán Tho·∫°i *</label>
            <input 
              type="tel" 
              id="phone"
              [(ngModel)]="newPMForm().phone" 
              name="phone"
              class="form-input"
              [class.error]="formErrors()['phone']"
              placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
            >
            <span *ngIf="formErrors()['phone']" class="error-message">{{ formErrors()['phone'] }}</span>
          </div>
          
          <div class="form-group">
            <label for="position">Ch·ª©c V·ª• *</label>
            <input 
              type="text" 
              id="position"
              [(ngModel)]="newPMForm().position" 
              name="position"
              class="form-input"
              [class.error]="formErrors()['position']"
              placeholder="Nh·∫≠p ch·ª©c v·ª•"
            >
            <span *ngIf="formErrors()['position']" class="error-message">{{ formErrors()['position'] }}</span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="department">Ph√≤ng Ban *</label>
            <input 
              type="text" 
              id="department"
              [(ngModel)]="newPMForm().department" 
              name="department"
              class="form-input"
              [class.error]="formErrors()['department']"
              placeholder="Nh·∫≠p ph√≤ng ban"
            >
            <span *ngIf="formErrors()['department']" class="error-message">{{ formErrors()['department'] }}</span>
          </div>
          
          <div class="form-group">
            <label for="startDate">Ng√†y B·∫Øt ƒê·∫ßu *</label>
            <input 
              type="date" 
              id="startDate"
              [(ngModel)]="newPMForm().startDate" 
              name="startDate"
              class="form-input"
              [class.error]="formErrors()['startDate']"
            >
            <span *ngIf="formErrors()['startDate']" class="error-message">{{ formErrors()['startDate'] }}</span>
          </div>
        </div>

        <div class="form-info">
          <p>üìß Email k√≠ch ho·∫°t s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒë·∫øn ƒë·ªãa ch·ªâ email ƒë√£ cung c·∫•p ƒë·ªÉ thi·∫øt l·∫≠p t√†i kho·∫£n.</p>
          <p>üîê T√†i kho·∫£n m·ªõi s·∫Ω ƒë∆∞·ª£c t·∫°o v·ªõi vai tr√≤ Project Manager v√† tr·∫°ng th√°i ch·ªù x·ª≠ l√Ω.</p>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeCreatePMModal()">H·ªßy</button>
      <button 
        class="btn btn-primary" 
        (click)="createNewPM()"
        [disabled]="isSubmitting()"
      >
        <span *ngIf="isSubmitting()" class="spinner-small"></span>
        {{ isSubmitting() ? 'ƒêang t·∫°o...' : 'T·∫°o Project Manager' }}
      </button>
    </div>
  </div>
</div>
