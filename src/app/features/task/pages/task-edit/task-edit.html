<div class="task-edit-page">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <div class="header-content">
        <h1>Edit Task</h1>
        <p>Update task information and details</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="cancel()">
          ← Back to Task
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading()" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading task data...</p>
    </div>

    <!-- Error -->
    <div *ngIf="errorMessage()" class="error-message">
      ⚠️ {{ errorMessage() }}
    </div>

    <!-- Form -->
    <form *ngIf="!isLoading()" (ngSubmit)="updateTask()" class="form-container">
      <div class="form-grid">
        <!-- Basic Info -->
        <div class="form-section">
          <h2>Basic Information</h2>

          <div class="form-group">
            <label>Task Title *</label>
            <input type="text" [formControl]="title" class="form-input" required />
          </div>

          <div class="form-group">
            <label>Description *</label>
            <textarea [formControl]="description" class="form-input" rows="4"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Priority</label>
              <select [formControl]="priority" class="form-select">
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
            <div class="form-group">
              <label>Status</label>
              <select [formControl]="status" class="form-select">
                <option value="todo">To Do</option>
                <option value="in-progress">In Progress</option>
                <option value="done">Done</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Due Date *</label>
            <input type="date" [formControl]="dueDate" class="form-input" />
          </div>
        </div>

        <!-- Assignment -->
        <div class="form-section">
          <h2>Assignment</h2>

          <div class="form-group">
            <label>Assign To *</label>
            <select [formControl]="assigneeId" class="form-select">
              <option value="">Select assignee</option>
              <option *ngFor="let u of users" [value]="u.id">
                {{ u.name }} ({{ u.email }})
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Project</label>
            <select [formControl]="projectId" class="form-select">
              <option value="">No project</option>
              <option *ngFor="let p of projects" [value]="p.id">{{ p.name }}</option>
            </select>
          </div>

          <div class="form-group">
            <label>Estimated Hours</label>
            <input type="number" [formControl]="estimatedHours" step="0.5" class="form-input" />
          </div>
        </div>
      </div>

      <!-- Tags -->
      <div class="form-section">
        <h2>Tags</h2>
        <div class="tags-grid">
          <button type="button"
                  *ngFor="let tag of availableTags"
                  class="tag-btn"
                  [class.selected]="tags().includes(tag)"
                  (click)="toggleTag(tag)">
            {{ tag }}
          </button>
        </div>

        <div *ngIf="tags().length" class="tags-list">
          <span *ngFor="let tag of tags()" class="tag-item">
            {{ tag }}
            <button type="button" (click)="removeTag(tag)">×</button>
          </span>
        </div>

        <div class="custom-tag-input">
          <input #tagInput type="text" placeholder="Enter custom tag" (keyup.enter)="addCustomTag(tagInput)" />
          <button type="button" (click)="addCustomTag(tagInput)">Add</button>
        </div>
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancel()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="isSubmitting()">
          <span *ngIf="isSubmitting()" class="loading-spinner"></span>
          {{ isSubmitting() ? 'Updating...' : 'Update Task' }}
        </button>
      </div>
    </form>
  </div>
</div>
